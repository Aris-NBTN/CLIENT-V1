import{r as o,j as e,f as k,V as je,a as be,c as ye,t as Ce,d as K,T as fe,ah as W,Q as Ne,an as ve,U as T,e as Ie,ac as y,ao as we,ap as Q,aq as Fe,ar as Se,as as Te,at as ke}from"./index-BxvyH6Rr.js";import{b7 as Ae}from"./Layout-D-b6lE7j.js";import{E as X,T as _}from"./Table-REsxD5Ay.js";import{F as B,a as Y,c as Z,b as De}from"./jspdf.es.min-CAZgi3nz.js";import{f as Oe,F as Pe,g as $e,d as ee,h as Le,T as Ve}from"./Format-CRg5OEfP.js";import{e as Me}from"./export-Cugonwx2.js";import{M as Re,a as qe}from"./index-KZwjyMtU.js";import{U as ze}from"./index-CCH4yInF.js";import{I as Ee}from"./index-BxAt0ZA8.js";import{R as _e,T as Be}from"./index-BseHglsf.js";import{T as V,h as He,a as d,b as H,i as Ue}from"./index-Cjwn6Pe1.js";import{F as s}from"./index-CKlBh-9v.js";import{B as g}from"./TextArea-DAakdzLg.js";import{M as U}from"./index-BBt4H8x4.js";import{I as x}from"./index-CtmaRZ4U.js";import{S as m}from"./index-BoYHRbe4.js";import{D as Ge}from"./index-BRVAjf1v.js";import{R as ae,C as f}from"./row-B3kiTypa.js";import"./index-CwcGwJlG.js";import"./index-Bp6v9eQC.js";import"./EllipsisOutlined-Cnz_QTxB.js";import"./Overflow-CRhK7xwX.js";import"./CheckOutlined-LGsS7MTB.js";import"./index-DVtQR3wx.js";import"./context-CrMMaZjm.js";import"./sortable.esm-DBGTLdO8.js";import"./addEventListener-6ANR8UZ4.js";import"./iconUtil-zxDw6b5a.js";import"./index-BU3bq95S.js";import"./index-DoS5Ws9L.js";import"./index-Dp9P72GA.js";import"./SearchOutlined-B1oW2Mb_.js";import"./index-D63e-2Lo.js";import"./ActionButton-BZ4HPW1v.js";import"./html2canvas.esm-CBrSDip1.js";import"./progress-BF-823P3.js";import"./index-CKMhmnPp.js";const Je=N=>new Promise((u,p)=>{const h=new FileReader;h.readAsDataURL(N),h.onload=()=>u(h.result),h.onerror=n=>p(n)}),te=({limit:N,apiUpload:u,body:p,fileLists:h,name:n})=>{const[A,r]=o.useState(!1),[D,O]=o.useState(""),v=h==="undefined"?[]:[{uid:h,name:h,status:"done",url:`${k}/uploads/${h}`}],[I,w]=o.useState(v);o.useEffect(()=>{w(v)},[h]);const M=async c=>{!c.url&&!c.preview&&(c.preview=await Je(c.originFileObj)),O(c.url||c.preview),r(!0)},F=({fileList:c,file:P})=>{w(c),P.status==="done"&&je.put({id:p,[n]:P.response})},R=e.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[e.jsx(_e,{}),e.jsx("div",{style:{marginTop:8},children:"Tải ảnh lên"})]});return e.jsxs(e.Fragment,{children:[e.jsx(ze,{data:{folder:"123"},action:u,listType:"picture-card",fileList:I,onPreview:M,onChange:F,children:I.length>=N?null:R}),D&&e.jsx(Ee,{wrapperStyle:{display:"none"},preview:{visible:A,onVisibleChange:c=>r(c),afterOpenChange:c=>!c&&O("")},src:D})]})};let Ke=0;const Oa=()=>{const N=be(),u=ye(),[p]=s.useForm(),[h]=s.useForm(),[n]=s.useForm(),[A]=s.useForm(),{token:{colorPrimary:r}}=Ce.useToken(),D=s.useWatch("price",p),O=s.useWatch("sale",p),[v,I]=o.useState(localStorage.getItem("drag")==="true"),w=o.useRef(null),[M,F]=o.useState(!1),[R,c]=o.useState(!1),[P,q]=o.useState(!1),[t,se]=o.useState(""),[G,le]=o.useState([]),[$,re]=o.useState({}),{courses:j,loading:L}=K(a=>a.courses),{categoryCourses:z,loading:E}=K(a=>a.categoryCourses),l=z==null?void 0:z.newData,J=o.useMemo(()=>{var a;return(a=j==null?void 0:j.newData)==null?void 0:a.map(i=>({...i,key:i._id}))},[j]),ne=o.useMemo(()=>l==null?void 0:l.map(a=>({...a,key:a._id})),[l]),ie=a=>{const{name:i,svgCode:S}=a,b=i||`New item ${Ke++}`;le([...G,b]),re({...$,[b]:S}),A.resetFields(),setTimeout(()=>{var C;(C=w.current)==null||C.focus()},0)},oe=[{title:"Tên khóa học",dataIndex:"name",width:"10%",type:"text",editable:!0,ellipsis:{showTitle:!0},...B({dataIndex:"name"}),render:a=>e.jsx(fe,{placement:"top",title:a,children:a})},{title:"Link",dataIndex:"slug",width:"10%",type:"text",editable:!1,ellipsis:{showTitle:!0},...B({dataIndex:"slug"}),render:a=>e.jsx(e.Fragment,{children:e.jsx(V.Paragraph,{className:"!mb-0",ellipsis:{suffix:""},copyable:{text:`/course/${a}`},children:a})})},{title:"Danh mục",dataIndex:"category",width:"10%",type:"select",editable:!0,optionSelect:Array.isArray(l)&&(l==null?void 0:l.length)>0?l==null?void 0:l.map(a=>({label:a.category,value:a._id})):[],...Array.isArray(l)&&(l==null?void 0:l.length)>0?Y("category",l==null?void 0:l.map(a=>({text:a.category,value:a._id}))):{},render:a=>a&&l&&Array.isArray(l)&&(l==null?void 0:l.length)>0?Oe(a,l,"category"):null},{title:"Giá",dataIndex:"price",width:"7%",type:"price",editable:!0,...Z({dataIndex:"price",type:"number"}),render:a=>Pe(a)},{title:"Giảm",dataIndex:"sale",width:"5%",type:"percent",editable:!0,...Z({dataIndex:"sale",type:"number"}),render:a=>$e(a)},{title:"Trang thái",dataIndex:"status",width:"8%",type:"select",optionSelect:[{label:"Đang bán",value:"Đang bán"},{label:"Chưa bán",value:"Chưa bán"}],editable:!0,...Y("status",[{value:"Đang bán",text:"Đang bán"},{value:"Chưa bán",text:"Chưa bán"}])},{title:"Sao",dataIndex:"star",width:"6%",type:"select",optionSelect:[{label:"3",value:"3"},{label:"4",value:"4"},{label:"4.5",value:"4.5"},{label:"5",value:"5"}],editable:!0},{title:"Ngày tạo",dataIndex:"createdAt",width:"8%",...De({dataIndex:"createdAt"}),render:a=>ee(a)},{title:"Cập nhập",dataIndex:"updatedAt",width:"8%",render:a=>Le(a)},{title:"Thông tin",dataIndex:"info",width:"7%",render:(a,i)=>e.jsx("div",{className:"flex justify-center",children:e.jsx(g,{type:"primary",ghost:!0,onClick:()=>{n.setFieldsValue(i),F(!0),se(i)},children:"Thông tin"})})}],ce=[{title:"Tên danh mục",dataIndex:"category",width:"70%",type:"text",editable:!0,...B({dataIndex:"category"})}],de=a=>{y(u,we(a),()=>{c(!1),p.resetFields()})},me=a=>{y(u,Q(a))},he=a=>{a.id=a.key,y(u,Q(a),()=>{F(!1),n.resetFields()})},ue=a=>{y(u,Fe(a))},pe=a=>{y(u,Se(a),()=>{q(!1),h.resetFields()})},ge=a=>{y(u,Te(a))},xe=a=>{y(u,ke(a))};return o.useEffect(()=>{L&&u(W({page:1,limit:localStorage.getItem("pageSize")||10}))},[]),o.useEffect(()=>{E&&u(Ne())},[]),o.useEffect(()=>{(()=>{const i=p.getFieldValue("price")||0,S=p.getFieldValue("sale")||0,b=i-i*S/100;p.setFieldsValue({priceSale:b>=0?b:0})})()},[D,O]),e.jsxs(Ae,{header:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center",children:e.jsx("h6",{className:"mb-0",children:"KHÓA HỌC"})})}),button:e.jsxs(e.Fragment,{children:[v?e.jsx(g,{onClick:()=>{I(!1),localStorage.setItem("drag","false")},children:e.jsx(V,{children:"Tắt sắp xếp"})}):e.jsx(g,{type:"primary",onClick:()=>{I(!0),localStorage.setItem("drag","true")},children:e.jsx(V,{children:"Bật sắp xếp "})}),e.jsx(g,{type:"primary",onClick:()=>{q(!0)},children:" Thêm danh mục"}),e.jsx(g,{type:"primary",onClick:()=>c(!0),children:"Thêm khóa học"}),e.jsx(g,{onClick:()=>Me(J,"Course.xlsx"),type:"primary",children:"Xuất file Excel"})]}),children:[e.jsx(X,{ApiPut:ve,Api:W,dragMode:v,total:j==null?void 0:j.totalPages,loading:L,data:J,columns:oe,onSave:me,onDelete:ue,button:a=>e.jsx("div",{className:"flex gap-3",children:e.jsx(Re,{onClick:()=>{N(`/admin/course/${a._id}`),localStorage.setItem("name-course",a.name)},size:20,color:"red"})})}),e.jsx(U,{title:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[" Thông tin khóa học: ",e.jsx(V.Text,{type:"danger",children:n.getFieldValue("name")})]}),e.jsx(g,{className:"me-4",icon:t!=null&&t.seo?e.jsx(He,{size:20,color:r}):e.jsx(qe,{size:20,color:"red"}),onClick:()=>{const a={"@context":"https://schema.org/","@id":t==null?void 0:t.slug,"@type":"Course",name:t==null?void 0:t.name,description:t==null?void 0:t.description,publisher:{"@type":"Organization",name:"Chicken War Studio",url:`${T}`},provider:{"@type":"Organization",name:"Chicken War Studio",url:`${T}`},image:[`${k}/upload/course/123/${t==null?void 0:t.imgDetail}`,`${k}/upload/course/123/${t==null?void 0:t.img}`],aggregateRating:{"@type":"AggregateRating",ratingValue:t==null?void 0:t.star,ratingCount:2e3,reviewCount:1200},offers:[{"@type":"Offer",category:t==null?void 0:t.category,priceCurrency:"VND",price:t==null?void 0:t.price}],hasCourseInstance:[{"@type":"CourseInstance",courseMode:"Blended",location:"HoChiMinh University",courseSchedule:{"@type":"Schedule",duration:"PT3H",repeatFrequency:"Daily",repeatCount:31},instructor:[{"@type":"Person",name:"Nguyen Bac Trung Nam",description:"3D Artist",image:`${T}`}]},{"@type":"CourseInstance",courseMode:"Online",courseWorkload:"PT22H"}],totalHistoricalEnrollment:400,datePublished:ee(t==null?void 0:t.createdAt),educationalLevel:"Advanced",about:["3D Modeling","3D environment","3D artist"],teaches:["Practice and apply systems thinking to plan for change","Understand how memory allocation works."],financialAidEligible:"Scholarship Available",inLanguage:"vn",availableLanguage:["vn","es"],coursePrerequisites:["Basic understanding of C++ up to arrays and functions.",`${T}`],educationalCredentialAwarded:[{"@type":"EducationalOccupationalCredential",name:"3D Modeling Certificate",url:`${T}`,credentialCategory:"Certificate"}]};Ie("ldjs","Tạo file thành công","Đã tạo file LD+JS, vui lòng cập nhập!"),n.setFieldValue("seo",a)},children:t!=null&&t.seo?"Đã tạo file LD+JS":"Tạo file LD+JS"})]})}),centered:!0,open:M,maskClosable:!1,onOk:()=>n.submit(),onCancel:()=>{F(!1),n.resetFields()},confirmLoading:L,width:800,children:e.jsxs(s,{form:n,name:"customForm",layout:"vertical",onFinish:he,children:[e.jsx(s.Item,{className:"mb-0 hidden",name:"key",children:e.jsx(x,{className:"mb-2"})}),e.jsx(s.Item,{className:"mb-2",name:"title",label:"Tiêu đề",children:e.jsx(x,{size:"large",className:"mb-2",placeholder:"Nhập tiêu đề"})}),e.jsx(s.Item,{className:"mb-2",name:"prerequisite",label:"Điều kiện tiên quyết",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập điều kiện tiên quyết",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"customer",label:"Đối tượng khách hàng",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập đối tượng khách hàng",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"output",label:"Tiêu chí đầu ra",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập tiêu chí đầu ra",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"benefit",label:"Lợi ích từ khóa học",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập lợi ích",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"includes",label:"Khóa học bao gồm",children:e.jsx(m,{size:"large",mode:"multiple",placeholder:"Chọn & nhập thông tin",tagRender:a=>{const{value:i,closable:S,onClose:b}=a;if(i!==void 0){const C=JSON.parse(i);return e.jsx(Ve,{style:{height:32,marginInlineEnd:4},closable:S,onClose:b,className:"flex items-center",children:e.jsxs("div",{className:"flex",children:[C.svgCode?e.jsx("div",{dangerouslySetInnerHTML:{__html:C.svgCode},style:{width:"20px",marginRight:"8px"}}):null,C.name]})})}},onChange:a=>{console.log(a)},dropdownRender:a=>e.jsxs(e.Fragment,{children:[a,e.jsx(Ge,{style:{margin:"8px 0"}}),e.jsx(s,{form:A,onFinish:ie,layout:"vertical",children:e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(s.Item,{name:"name",className:"!mb-0",rules:[{required:!0,message:"Nhập thông tin!"}],children:e.jsx(x,{style:{width:200},placeholder:"Nhập thông tin",ref:w,onKeyDown:i=>i.stopPropagation()})}),e.jsx(s.Item,{name:"svgCode",className:"!mb-0",rules:[{required:!0,message:"Nhập SVG icon!"}],children:e.jsx(x,{style:{width:200},placeholder:"Nhập mã SVG icon",onKeyDown:i=>i.stopPropagation()})}),e.jsx(g,{className:"w-full",type:"primary",ghost:!0,htmlType:"submit",children:"Thêm thông tin"})]})})]}),options:G.map(a=>({label:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[$[a]&&e.jsx("div",{dangerouslySetInnerHTML:{__html:$[a]},style:{width:"20px",marginRight:"8px"}}),a]}),value:JSON.stringify({name:a,svgCode:$[a]||""})}))})}),e.jsx(s.Item,{className:"mb-2",name:"hidden",label:"Ẩn thông tin",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn thông tin cần ẩn",mode:"multiple",options:[{label:"Lợi ích từ khóa học",value:"benefit"},{label:"Yêu cầu khóa học",value:"prerequisite"},{label:"Đối tượng khách hàng",value:"customer"},{label:"Tiêu chí đầu ra",value:"output"},{label:"Nội dung khóa học",value:"module"},{label:"Đánh giá từ học viên",value:"review"}]})}),e.jsx(s.Item,{className:"mb-0 hidden",name:"seo",children:e.jsx(x,{className:"mb-2"})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap mt-2 gap-2 justify-center",children:[e.jsx(s.Item,{className:"mb-2",label:"Ảnh bìa",children:e.jsx(te,{apiUpload:`${k}/v1/courser/image`,name:"img",body:n==null?void 0:n.getFieldValue("_id"),fileLists:`${n==null?void 0:n.getFieldValue("img")}`,limit:1})}),e.jsx(s.Item,{className:"mb-2",label:"Ảnh chi tiết",children:e.jsx(te,{apiUpload:`${k}/v1/courser/image`,name:"imgDetail",body:n.getFieldValue("_id"),fileLists:`${n.getFieldValue("imgDetail")}`,limit:1})}),e.jsx(s.Item,{className:"w-full mb-2",name:"description",label:" Mô tả",children:e.jsx(x.TextArea,{size:"large",className:"mb-2",placeholder:"Nhập mô tả",style:{height:100,resize:"none"}})})]})]})}),e.jsx(U,{title:"Khóa học",centered:!0,open:R,onOk:()=>p.submit(),onCancel:()=>c(!1),confirmLoading:L,width:600,children:e.jsxs(s,{form:p,name:"customForm",layout:"vertical",onFinish:de,children:[e.jsx(s.Item,{className:"mb-2",name:"name",label:"Tên khóa học",rules:[{required:!0,message:"Nhập tên khóa học!"}],children:e.jsx(x,{placeholder:"Nhập tên khóa học"})}),e.jsxs(ae,{gutter:[14,14],children:[e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"category",label:"Danh mục",rules:[{required:!0,message:"Chọn danh mục!"}],children:e.jsx(m,{options:l==null?void 0:l.map(a=>({label:a.category,value:a._id})),placeholder:"Chọn danh mục"})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"status",label:"Trạng thái",rules:[{required:!0,message:"Chọn trạng thái!"}],children:e.jsxs(m,{placeholder:"Chọn trạng thái",children:[e.jsx(m.Option,{value:"Đang bán",children:"Đang bán"}),e.jsx(m.Option,{value:"Chưa bán",children:"Chưa bán"})]})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"star",label:"Số sao",rules:[{required:!0,message:"Chọn số sao!"}],children:e.jsxs(m,{placeholder:"Chọn trạng thái",children:[e.jsx(m.Option,{value:"3",children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(H,{color:r}),e.jsx(H,{color:r})]})}),e.jsx(m.Option,{value:"4",children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(H,{color:r})]})}),e.jsx(m.Option,{value:"4.5",children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(Ue,{color:r})]})}),e.jsx(m.Option,{value:"5",children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r}),e.jsx(d,{color:r})]})})]})})})]}),e.jsxs(ae,{gutter:[14,14],children:[e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"price",label:"Giá tiền VN",rules:[{required:!0,message:"Nhập giá tiền!"}],children:e.jsx(_,{className:"w-full mb-2",placeholder:"Nhập giá tiền",min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"sale",label:"Giảm giá %",rules:[{required:!0,message:"Nhập %!"}],children:e.jsx(_,{className:"w-full mb-2",placeholder:"Nhập %",min:0,max:100,step:5})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",label:"Giá sau khi giảm",name:"priceSale",children:e.jsx(_,{className:"w-full mb-2",placeholder:"Giá sau khi giảm",readOnly:!0,min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})})]})]})}),e.jsx(U,{centered:!0,open:P,onCancel:()=>q(!1),footer:null,width:600,children:e.jsx(Be,{centered:!0,items:[{label:"Thêm danh mục",key:"1",children:e.jsx(e.Fragment,{children:e.jsxs(s,{form:h,name:"customForm",layout:"vertical",onFinish:pe,children:[e.jsx(s.Item,{className:"mb-3",name:"category",label:"Tên danh mục",rules:[{required:!0,message:"Nhập tên danh mục!"}],children:e.jsx(x,{placeholder:"Nhập tên danh mục"})}),e.jsx(g,{type:"primary",loading:E,onClick:()=>h.submit(),className:"flex float-end",children:"Thêm danh mục"})]})})},{label:"Chỉnh sửa danh mục",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(X,{loading:E,data:ne,columns:ce,onSave:ge,onDelete:xe,width:"20%",scroll:{x:500,y:350}})})}]})})]})};export{Oa as default};

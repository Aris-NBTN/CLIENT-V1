import{r as s,q as A,s as c,w as H,aZ as j,a_ as q,a$ as I,j as d,E as g,F as R,b0 as O,t as W}from"./index-BdhBU5GP.js";import{b7 as _}from"./Layout-BwiWDovC.js";import{P as G,p as J,b as N,a as U,B as a}from"./index-B4ECPkWr.js";import{p as Z,a as z,S as k}from"./index-Dg-iPfYn.js";import"./index-DYnzX4K8.js";import"./EllipsisOutlined-C6ElPvKq.js";import"./Overflow-DPzNmnPK.js";import"./context-CslYV-ki.js";import"./index-DRaXnXIP.js";import"./index-2DJx2EuV.js";import"./index-CJiZPHP6.js";import"./row-B0R_ls19.js";import"./index-R47mglxy.js";import"./useLocale-HPXoXIa7.js";import"./TextArea-CWmORkq3.js";import"./CheckOutlined-CGnn5XWP.js";import"./compact-item-CVdIMyqT.js";import"./button-DdT8d_PY.js";import"./index-DgdirtnL.js";import"./PurePanel-rwDXggek.js";import"./index-Bz0gXpZN.js";import"./SearchOutlined-oRTM7csC.js";import"./Dropdown-B8hjc5lE.js";import"./index-WbciJVvx.js";import"./index-CYAxck_T.js";import"./fileApi-B0_-ZA3j.js";const xt=()=>{var b,v;const[B,C]=s.useState(""),[h,T]=s.useState(!1),f=A(),S=c(t=>t.pluginsScript.pluginsScript),M=c(t=>t.pluginsScript.loading),{plugins:i,loading:E}=c(t=>t.plugins),{pluginsScript:$}=c(t=>t.pluginsScript);s.useMemo(()=>{var t;return(t=i==null?void 0:i.newData)==null?void 0:t.map(o=>({id:o.id,src:`${H}/uploads/${o.src}`}))},[i]);const D=(t,o)=>{const r=new Date,{html:n,css:l,js:e}=o,x=new DOMParser().parseFromString(n,"text/html"),p=x.querySelector("#Header"),u=x.querySelector("#Footer");let y="",L="";const P=n.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(P&&P[1].trim()===""&&console.log("không có dữ liệu"),!p){g("Chưa có Header!");return}if(!u){g("Chưa có Footer!");return}p&&(y=`<div class="${p.className}">${p.innerHTML}</div>`),u&&(L=`<div id="Footer">${u.innerHTML}</div>`),R(r,"Đang cập nhật..."),j.putLayout(O,{header:y,footer:L,css:l,js:e,edit:t}).then(()=>{W(r,"Cập nhật thành công")}).catch(w=>{g(w.response.data.message)})},F=t=>{t.loadProjectData(B.edit);const o=["video","map","video","bootstrapIcon","map","model-3D","Masonry","quote","link-block","text-basic","text-section","column1","column2","column3","column3-7"],r=["gjs-open-import-webpage","open-templates","link-page","export-template"],n=["Extra","Blog","Layout","Short Codes"],{models:l}=t.BlockManager.getCategories();o.forEach(e=>t.BlockManager.remove(e)),r.forEach(e=>{t.Panels.removeButton("options",e)}),l.forEach(e=>{var m;return n.includes((m=e.get)==null?void 0:m.call(e,"id"))&&e.set("open",!1)})};return s.useEffect(()=>{j.getLayoutEdit().then(t=>{C(t[0]),T(!0)})},[]),s.useEffect(()=>{M===!0&&f(q())},[]),s.useEffect(()=>{E===!0&&f(I())},[]),d.jsxs(_,{margin:0,header:"BỐ CỤC WEBSITE",children:[!h&&d.jsx("div",{children:"LOAdding"}),h&&!E&&d.jsx(G,{height:"calc(100vh - 56px)",configGrapeJs:F,scripts:(b=S[0])==null?void 0:b.scripts,styles:(v=S[0])==null?void 0:v.styles,pluginss:[{id:"grapesjs-component-icon",src:"http://localhost:8082/plugins/icon/IndexLayout.js"}],plugins:[J,N,U,Z,z,a.imageLink,a.header,a.footer,a.container,a.user,k.customType,k.customTypeSelect],canvas:$[0],savePage:D})]})};export{xt as default};

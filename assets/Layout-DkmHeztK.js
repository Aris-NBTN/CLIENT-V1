import{r as o,d as m,f as H,c as R,b1 as P,b2 as q,b3 as w,j as u,V as d,a1 as I,b4 as O,e as W}from"./index-DP1V69zW.js";import{b7 as G}from"./Layout-CSBaKIyk.js";import{P as J,p as N,b as U,a as V,c as _,d as z,B as s}from"./index-DzdgqXZf.js";import{S as k}from"./index-BcZ8U7N5.js";import"./animate-BLR1f4cK.js";import"./context-Da65SXmW.js";import"./index-yZxeADuP.js";import"./index-BydWB8v5.js";import"./index-DFykVV_M.js";import"./EllipsisOutlined-DhRthh2E.js";import"./Overflow-CoYDRUi5.js";import"./collapse-BbEVqHco.js";import"./button-HVL6HZTA.js";import"./index-B4Ih51-e.js";import"./compact-item-0yAQBS03.js";import"./index-3PGxJzma.js";import"./useLocale-Cb2Gte2h.js";import"./TextArea-B62akKnf.js";import"./CheckOutlined-Dp6bSQXc.js";import"./index-XepFwzBg.js";import"./PurePanel-DvsEAgfB.js";import"./index-DEwoyq_X.js";import"./SearchOutlined-Gb7yx87W.js";import"./index-CkMk41Ts.js";import"./responsiveObserver-CRVZkOUO.js";import"./GrapeJs-CKywyhwp.js";import"./fileApi-DSvnIbS7.js";import"./row-BIWXMvdS.js";const Lt=()=>{var S,E;const[B,C]=o.useState(""),[g,j]=o.useState(!1),f=m(t=>t.pluginsScript.pluginsScript),T=m(t=>t.pluginsScript.loading),{plugins:h,loading:M}=m(t=>t.plugins),$=o.useMemo(()=>h.map(t=>({id:t.id,src:`${H}/uploads/${t.src}`})),[h]),b=R(),A=(t,n)=>{const a=new Date,{html:i,css:p,js:e}=n,v=new DOMParser().parseFromString(i,"text/html"),r=v.querySelector("#Header"),l=v.querySelector("#Footer");let x="",y="";const L=i.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(L&&L[1].trim()===""&&console.log("không có dữ liệu"),!r){d("Chưa có Header!");return}if(!l){d("Chưa có Footer!");return}r&&(x=`<div class="${r.className}">${r.innerHTML}</div>`),l&&(y=`<div id="Footer">${l.innerHTML}</div>`),I(a,"Đang cập nhật..."),P.putLayout(O,{header:x,footer:y,css:p,js:e,edit:t}).then(()=>{W(a,"Cập nhật thành công")}).catch(F=>{d(F.response.data.message)})},D=t=>{t.loadProjectData(B.edit);const n=["video","map","video","bootstrapIcon","map","model-3D","Masonry","quote","link-block","text-basic","text-section","column1","column2","column3","column3-7"],a=["gjs-open-import-webpage","open-templates","link-page","export-template"],i=["Extra","Blog","Layout","Short Codes"],{models:p}=t.BlockManager.getCategories();n.forEach(e=>t.BlockManager.remove(e)),a.forEach(e=>{t.Panels.removeButton("options",e)}),p.forEach(e=>{var c;return i.includes((c=e.get)==null?void 0:c.call(e,"id"))&&e.set("open",!1)})};return o.useEffect(()=>{P.getLayoutEdit().then(t=>{C(t[0]),j(!0)})},[]),o.useEffect(()=>{T===!0&&b(q())},[]),o.useEffect(()=>{M===!0&&b(w())},[]),u.jsxs(G,{margin:0,header:"BỐ CỤC WEBSITE",children:[!g&&u.jsx("div",{children:"LOAdding"}),g&&u.jsx(J,{height:"calc(100vh - 56px)",configGrapeJs:D,scripts:(S=f[0])==null?void 0:S.scripts,styles:(E=f[0])==null?void 0:E.styles,pluginss:$,plugins:[N,U,V,_,z,s.imageLink,s.header,s.footer,s.container,s.user,k.customType,k.customTypeSelect],savePage:A})]})};export{Lt as default};

import{r as o,c as H,d as u,f as w,aW as k,aX as I,aI as R,j as d,W as g,a3 as W,aY as q,e as O}from"./index-D_8e4c1c.js";import{b7 as G}from"./Layout-CyzyjsxQ.js";import{P as J,p as N,a as U,B as a}from"./index-BcyNr5lV.js";import{p as X,b as Y,a as _}from"./index-BOOS2E1S.js";import{S as B}from"./index-BcZ8U7N5.js";import"./index-Dmxhq2rE.js";import"./index-DUMoXffW.js";import"./EllipsisOutlined-DotS4OyN.js";import"./Overflow-D7J6rgzg.js";import"./CheckOutlined-DdAy9wLR.js";import"./TextArea-CWw6Kbja.js";import"./index-BMT87hfN.js";import"./context-CZuqpdQ0.js";import"./index-D2w-eL_m.js";import"./index-Bk93MzKf.js";import"./index-Coxcvceq.js";import"./SearchOutlined-CK_rNMR1.js";import"./fileApi-DFQQgF_Z.js";import"./indexFile-CjJi2Tza.js";import"./row-9dsEpJck.js";const ft=()=>{var b,v;const[C,j]=o.useState(""),[f,T]=o.useState(!1),h=H(),S=u(t=>t.pluginsScript.pluginsScript),M=u(t=>t.pluginsScript.loading),{plugins:i,loading:E}=u(t=>t.plugins),D=o.useMemo(()=>{var t;return(t=i==null?void 0:i.newData)==null?void 0:t.map(s=>({id:s.id,src:`${w}/uploads/${s.src}`}))},[i]),$=(t,s)=>{const r=new Date,{html:n,css:p,js:e}=s,x=new DOMParser().parseFromString(n,"text/html"),c=x.querySelector("#Header"),m=x.querySelector("#Footer");let y="",L="";const P=n.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(P&&P[1].trim()===""&&console.log("không có dữ liệu"),!c){g("Chưa có Header!");return}if(!m){g("Chưa có Footer!");return}c&&(y=`<div class="${c.className}">${c.innerHTML}</div>`),m&&(L=`<div id="Footer">${m.innerHTML}</div>`),W(r,"Đang cập nhật..."),k.putLayout(q,{header:y,footer:L,css:p,js:e,edit:t}).then(()=>{O(r,"Cập nhật thành công")}).catch(F=>{g(F.response.data.message)})},A=t=>{t.loadProjectData(C.edit);const s=["video","map","video","bootstrapIcon","map","model-3D","Masonry","quote","link-block","text-basic","text-section","column1","column2","column3","column3-7"],r=["gjs-open-import-webpage","open-templates","link-page","export-template"],n=["Extra","Blog","Layout","Short Codes"],{models:p}=t.BlockManager.getCategories();s.forEach(e=>t.BlockManager.remove(e)),r.forEach(e=>{t.Panels.removeButton("options",e)}),p.forEach(e=>{var l;return n.includes((l=e.get)==null?void 0:l.call(e,"id"))&&e.set("open",!1)})};return o.useEffect(()=>{k.getLayoutEdit().then(t=>{j(t[0]),T(!0)})},[]),o.useEffect(()=>{M===!0&&h(I())},[]),o.useEffect(()=>{E===!0&&h(R())},[]),d.jsxs(G,{margin:0,header:"BỐ CỤC WEBSITE",children:[!f&&d.jsx("div",{children:"LOAdding"}),f&&!E&&d.jsx(J,{height:"calc(100vh - 56px)",configGrapeJs:A,scripts:(b=S[0])==null?void 0:b.scripts,styles:(v=S[0])==null?void 0:v.styles,pluginss:D,plugins:[X,Y,_,N,U,a.imageLink,a.header,a.footer,a.container,a.user,B.customType,B.customTypeSelect],savePage:$})]})};export{ft as default};

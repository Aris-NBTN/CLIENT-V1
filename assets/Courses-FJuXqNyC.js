import{r as i,j as e,f as k,V as xe,a as je,c as be,t as ye,d as J,T as Ce,ah as K,Q as fe,an as Ne,U as T,e as ve,ac as y,ao as Ie,ap as W,aq as we,ar as Fe,as as Se,at as Te}from"./index-D_8e4c1c.js";import{b7 as ke}from"./Layout-CyzyjsxQ.js";import{E as Q,T as E}from"./Table-BscFkU2Z.js";import{F as _,a as X,c as Y,b as Ae}from"./jspdf.es.min-DtfdLfp_.js";import{f as De,F as Oe,g as Pe,d as Z,h as $e,T as Le}from"./Format-D701Ge6d.js";import{e as Ve}from"./export-ROJ2lOPZ.js";import{M as Me,a as Re}from"./index-BvDRiMRD.js";import{U as qe}from"./index-C0CwbIGo.js";import{I as ze}from"./index-BaGHfT5U.js";import{R as Ee,T as _e}from"./index-CGW289Qd.js";import{T as V,h as Be,a as c,b as B,i as He}from"./index-Dmxhq2rE.js";import{F as s}from"./index-BK034_kP.js";import{B as g}from"./TextArea-CWw6Kbja.js";import{M as H}from"./index-BkKl_ZBW.js";import{I as x}from"./index-BkckKk1m.js";import{S as m}from"./index-Bk93MzKf.js";import{D as Ue}from"./index-C77HSEF6.js";import{R as ee,C as f}from"./row-9dsEpJck.js";import"./index-D2w-eL_m.js";import"./index-DUMoXffW.js";import"./EllipsisOutlined-DotS4OyN.js";import"./Overflow-D7J6rgzg.js";import"./CheckOutlined-DdAy9wLR.js";import"./index-BMT87hfN.js";import"./context-CZuqpdQ0.js";import"./sortable.esm-WutAO-q0.js";import"./addEventListener-CB8yRRsv.js";import"./iconUtil-CFlHBpPL.js";import"./index-BtrI-hsZ.js";import"./index-Coxcvceq.js";import"./index-Dm38w3Iq.js";import"./SearchOutlined-CK_rNMR1.js";import"./index-F-ZYeqsl.js";import"./ActionButton-BdPhl_ld.js";import"./html2canvas.esm-CBrSDip1.js";import"./progress-Bt0xywbQ.js";import"./index-uxb3IG00.js";const Ge=N=>new Promise((u,p)=>{const h=new FileReader;h.readAsDataURL(N),h.onload=()=>u(h.result),h.onerror=r=>p(r)}),ae=({limit:N,apiUpload:u,body:p,fileLists:h,name:r})=>{const[A,l]=i.useState(!1),[D,O]=i.useState(""),v=h==="undefined"?[]:[{uid:h,name:h,status:"done",url:`${k}/uploads/${h}`}],[I,w]=i.useState(v);i.useEffect(()=>{w(v)},[h]);const M=async o=>{!o.url&&!o.preview&&(o.preview=await Ge(o.originFileObj)),O(o.url||o.preview),l(!0)},F=({fileList:o,file:P})=>{w(o),P.status==="done"&&xe.put({id:p,[r]:P.response})},R=e.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[e.jsx(Ee,{}),e.jsx("div",{style:{marginTop:8},children:"Tải ảnh lên"})]});return e.jsxs(e.Fragment,{children:[e.jsx(qe,{data:{folder:"123"},action:u,listType:"picture-card",fileList:I,onPreview:M,onChange:F,children:I.length>=N?null:R}),D&&e.jsx(ze,{wrapperStyle:{display:"none"},preview:{visible:A,onVisibleChange:o=>l(o),afterOpenChange:o=>!o&&O("")},src:D})]})};let Je=0;const Da=()=>{const N=je(),u=be(),[p]=s.useForm(),[h]=s.useForm(),[r]=s.useForm(),[A]=s.useForm(),{token:{colorPrimary:l}}=ye.useToken(),D=s.useWatch("price",p),O=s.useWatch("sale",p),[v,I]=i.useState(localStorage.getItem("drag")==="true"),w=i.useRef(null),[M,F]=i.useState(!1),[R,o]=i.useState(!1),[P,q]=i.useState(!1),[t,te]=i.useState(""),[U,se]=i.useState([]),[$,le]=i.useState({}),{courses:j,loading:L}=J(a=>a.courses),{categoryCourses:d,loading:z}=J(a=>a.categoryCourses),G=i.useMemo(()=>{var a;return(a=j==null?void 0:j.newData)==null?void 0:a.map(n=>({...n,key:n._id}))},[j]),re=i.useMemo(()=>d.map(a=>({...a,key:a._id})),[d]),ne=a=>{const{name:n,svgCode:S}=a,b=n||`New item ${Je++}`;se([...U,b]),le({...$,[b]:S}),A.resetFields(),setTimeout(()=>{var C;(C=w.current)==null||C.focus()},0)},ie=[{title:"Tên khóa học",dataIndex:"name",width:"10%",type:"text",editable:!0,ellipsis:{showTitle:!0},..._({dataIndex:"name"}),render:a=>e.jsx(Ce,{placement:"top",title:a,children:a})},{title:"Link",dataIndex:"slug",width:"10%",type:"text",editable:!1,ellipsis:{showTitle:!0},..._({dataIndex:"slug"}),render:a=>e.jsx(e.Fragment,{children:e.jsx(V.Paragraph,{className:"!mb-0",ellipsis:{suffix:""},copyable:{text:`/course/${a}`},children:a})})},{title:"Danh mục",dataIndex:"category",width:"10%",type:"select",editable:!0,optionSelect:Array.isArray(d)&&d.length>0?d==null?void 0:d.map(a=>({label:a.category,value:a._id})):[],...Array.isArray(d)&&d.length>0?X("category",d.map(a=>({text:a.category,value:a._id}))):{},render:a=>a&&d&&Array.isArray(d)&&d.length>0?De(a,d,"category"):null},{title:"Giá",dataIndex:"price",width:"7%",type:"price",editable:!0,...Y({dataIndex:"price",type:"number"}),render:a=>Oe(a)},{title:"Giảm",dataIndex:"sale",width:"5%",type:"percent",editable:!0,...Y({dataIndex:"sale",type:"number"}),render:a=>Pe(a)},{title:"Trang thái",dataIndex:"status",width:"8%",type:"select",optionSelect:[{label:"Đang bán",value:"Đang bán"},{label:"Chưa bán",value:"Chưa bán"}],editable:!0,...X("status",[{value:"Đang bán",text:"Đang bán"},{value:"Chưa bán",text:"Chưa bán"}])},{title:"Sao",dataIndex:"star",width:"6%",type:"select",optionSelect:[{label:"3",value:"3"},{label:"4",value:"4"},{label:"4.5",value:"4.5"},{label:"5",value:"5"}],editable:!0},{title:"Ngày tạo",dataIndex:"createdAt",width:"8%",...Ae({dataIndex:"createdAt"}),render:a=>Z(a)},{title:"Cập nhập",dataIndex:"updatedAt",width:"8%",render:a=>$e(a)},{title:"Thông tin",dataIndex:"info",width:"7%",render:(a,n)=>e.jsx("div",{className:"flex justify-center",children:e.jsx(g,{type:"primary",ghost:!0,onClick:()=>{r.setFieldsValue(n),F(!0),te(n)},children:"Thông tin"})})}],oe=[{title:"Tên danh mục",dataIndex:"category",width:"70%",type:"text",editable:!0,..._({dataIndex:"category"})}],ce=a=>{y(u,Ie(a),()=>{o(!1),p.resetFields()})},de=a=>{y(u,W(a))},me=a=>{a.id=a.key,y(u,W(a),()=>{F(!1),r.resetFields()})},he=a=>{y(u,we(a))},ue=a=>{y(u,Fe(a),()=>{q(!1),h.resetFields()})},pe=a=>{y(u,Se(a))},ge=a=>{y(u,Te(a))};return i.useEffect(()=>{L&&u(K({page:1,limit:localStorage.getItem("pageSize")||10}))},[]),i.useEffect(()=>{z&&u(fe())},[]),i.useEffect(()=>{(()=>{const n=p.getFieldValue("price")||0,S=p.getFieldValue("sale")||0,b=n-n*S/100;p.setFieldsValue({priceSale:b>=0?b:0})})()},[D,O]),e.jsxs(ke,{header:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center",children:e.jsx("h6",{className:"mb-0",children:"KHÓA HỌC"})})}),button:e.jsxs(e.Fragment,{children:[v?e.jsx(g,{onClick:()=>{I(!1),localStorage.setItem("drag","false")},children:e.jsx(V,{children:"Tắt sắp xếp"})}):e.jsx(g,{type:"primary",onClick:()=>{I(!0),localStorage.setItem("drag","true")},children:e.jsx(V,{children:"Bật sắp xếp "})}),e.jsx(g,{type:"primary",onClick:()=>{q(!0)},children:" Thêm danh mục"}),e.jsx(g,{type:"primary",onClick:()=>o(!0),children:"Thêm khóa học"}),e.jsx(g,{onClick:()=>Ve(G,"Course.xlsx"),type:"primary",children:"Xuất file Excel"})]}),children:[e.jsx(Q,{ApiPut:Ne,Api:K,dragMode:v,total:j==null?void 0:j.totalPages,loading:L,data:G,columns:ie,onSave:de,onDelete:he,button:a=>e.jsx("div",{className:"flex gap-3",children:e.jsx(Me,{onClick:()=>{N(`/admin/course/${a._id}`),localStorage.setItem("name-course",a.name)},size:20,color:"red"})})}),e.jsx(H,{title:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[" Thông tin khóa học: ",e.jsx(V.Text,{type:"danger",children:r.getFieldValue("name")})]}),e.jsx(g,{className:"me-4",icon:t!=null&&t.seo?e.jsx(Be,{size:20,color:l}):e.jsx(Re,{size:20,color:"red"}),onClick:()=>{const a={"@context":"https://schema.org/","@id":t==null?void 0:t.slug,"@type":"Course",name:t==null?void 0:t.name,description:t==null?void 0:t.description,publisher:{"@type":"Organization",name:"Chicken War Studio",url:`${T}`},provider:{"@type":"Organization",name:"Chicken War Studio",url:`${T}`},image:[`${k}/upload/course/123/${t==null?void 0:t.imgDetail}`,`${k}/upload/course/123/${t==null?void 0:t.img}`],aggregateRating:{"@type":"AggregateRating",ratingValue:t==null?void 0:t.star,ratingCount:2e3,reviewCount:1200},offers:[{"@type":"Offer",category:t==null?void 0:t.category,priceCurrency:"VND",price:t==null?void 0:t.price}],hasCourseInstance:[{"@type":"CourseInstance",courseMode:"Blended",location:"HoChiMinh University",courseSchedule:{"@type":"Schedule",duration:"PT3H",repeatFrequency:"Daily",repeatCount:31},instructor:[{"@type":"Person",name:"Nguyen Bac Trung Nam",description:"3D Artist",image:`${T}`}]},{"@type":"CourseInstance",courseMode:"Online",courseWorkload:"PT22H"}],totalHistoricalEnrollment:400,datePublished:Z(t==null?void 0:t.createdAt),educationalLevel:"Advanced",about:["3D Modeling","3D environment","3D artist"],teaches:["Practice and apply systems thinking to plan for change","Understand how memory allocation works."],financialAidEligible:"Scholarship Available",inLanguage:"vn",availableLanguage:["vn","es"],coursePrerequisites:["Basic understanding of C++ up to arrays and functions.",`${T}`],educationalCredentialAwarded:[{"@type":"EducationalOccupationalCredential",name:"3D Modeling Certificate",url:`${T}`,credentialCategory:"Certificate"}]};ve("ldjs","Tạo file thành công","Đã tạo file LD+JS, vui lòng cập nhập!"),r.setFieldValue("seo",a)},children:t!=null&&t.seo?"Đã tạo file LD+JS":"Tạo file LD+JS"})]})}),centered:!0,open:M,maskClosable:!1,onOk:()=>r.submit(),onCancel:()=>{F(!1),r.resetFields()},confirmLoading:L,width:800,children:e.jsxs(s,{form:r,name:"customForm",layout:"vertical",onFinish:me,children:[e.jsx(s.Item,{className:"mb-0 hidden",name:"key",children:e.jsx(x,{className:"mb-2"})}),e.jsx(s.Item,{className:"mb-2",name:"title",label:"Tiêu đề",children:e.jsx(x,{size:"large",className:"mb-2",placeholder:"Nhập tiêu đề"})}),e.jsx(s.Item,{className:"mb-2",name:"prerequisite",label:"Điều kiện tiên quyết",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập điều kiện tiên quyết",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"customer",label:"Đối tượng khách hàng",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập đối tượng khách hàng",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"output",label:"Tiêu chí đầu ra",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập tiêu chí đầu ra",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"benefit",label:"Lợi ích từ khóa học",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập lợi ích",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"includes",label:"Khóa học bao gồm",children:e.jsx(m,{size:"large",mode:"multiple",placeholder:"Chọn & nhập thông tin",tagRender:a=>{const{value:n,closable:S,onClose:b}=a;if(n!==void 0){const C=JSON.parse(n);return e.jsx(Le,{style:{height:32,marginInlineEnd:4},closable:S,onClose:b,className:"flex items-center",children:e.jsxs("div",{className:"flex",children:[C.svgCode?e.jsx("div",{dangerouslySetInnerHTML:{__html:C.svgCode},style:{width:"20px",marginRight:"8px"}}):null,C.name]})})}},onChange:a=>{console.log(a)},dropdownRender:a=>e.jsxs(e.Fragment,{children:[a,e.jsx(Ue,{style:{margin:"8px 0"}}),e.jsx(s,{form:A,onFinish:ne,layout:"vertical",children:e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(s.Item,{name:"name",className:"!mb-0",rules:[{required:!0,message:"Nhập thông tin!"}],children:e.jsx(x,{style:{width:200},placeholder:"Nhập thông tin",ref:w,onKeyDown:n=>n.stopPropagation()})}),e.jsx(s.Item,{name:"svgCode",className:"!mb-0",rules:[{required:!0,message:"Nhập SVG icon!"}],children:e.jsx(x,{style:{width:200},placeholder:"Nhập mã SVG icon",onKeyDown:n=>n.stopPropagation()})}),e.jsx(g,{className:"w-full",type:"primary",ghost:!0,htmlType:"submit",children:"Thêm thông tin"})]})})]}),options:U.map(a=>({label:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[$[a]&&e.jsx("div",{dangerouslySetInnerHTML:{__html:$[a]},style:{width:"20px",marginRight:"8px"}}),a]}),value:JSON.stringify({name:a,svgCode:$[a]||""})}))})}),e.jsx(s.Item,{className:"mb-2",name:"hidden",label:"Ẩn thông tin",children:e.jsx(m,{size:"large",className:"w-full mb-2",placeholder:"Chọn thông tin cần ẩn",mode:"multiple",options:[{label:"Lợi ích từ khóa học",value:"benefit"},{label:"Yêu cầu khóa học",value:"prerequisite"},{label:"Đối tượng khách hàng",value:"customer"},{label:"Tiêu chí đầu ra",value:"output"},{label:"Nội dung khóa học",value:"module"},{label:"Đánh giá từ học viên",value:"review"}]})}),e.jsx(s.Item,{className:"mb-0 hidden",name:"seo",children:e.jsx(x,{className:"mb-2"})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap mt-2 gap-2 justify-center",children:[e.jsx(s.Item,{className:"mb-2",label:"Ảnh bìa",children:e.jsx(ae,{apiUpload:`${k}/v1/courser/image`,name:"img",body:r==null?void 0:r.getFieldValue("_id"),fileLists:`${r==null?void 0:r.getFieldValue("img")}`,limit:1})}),e.jsx(s.Item,{className:"mb-2",label:"Ảnh chi tiết",children:e.jsx(ae,{apiUpload:`${k}/v1/courser/image`,name:"imgDetail",body:r.getFieldValue("_id"),fileLists:`${r.getFieldValue("imgDetail")}`,limit:1})}),e.jsx(s.Item,{className:"w-full mb-2",name:"description",label:" Mô tả",children:e.jsx(x.TextArea,{size:"large",className:"mb-2",placeholder:"Nhập mô tả",style:{height:100,resize:"none"}})})]})]})}),e.jsx(H,{title:"Khóa học",centered:!0,open:R,onOk:()=>p.submit(),onCancel:()=>o(!1),confirmLoading:L,width:600,children:e.jsxs(s,{form:p,name:"customForm",layout:"vertical",onFinish:ce,children:[e.jsx(s.Item,{className:"mb-2",name:"name",label:"Tên khóa học",rules:[{required:!0,message:"Nhập tên khóa học!"}],children:e.jsx(x,{placeholder:"Nhập tên khóa học"})}),e.jsxs(ee,{gutter:[14,14],children:[e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"category",label:"Danh mục",rules:[{required:!0,message:"Chọn danh mục!"}],children:e.jsx(m,{options:d.map(a=>({label:a.category,value:a._id})),placeholder:"Chọn danh mục"})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"status",label:"Trạng thái",rules:[{required:!0,message:"Chọn trạng thái!"}],children:e.jsxs(m,{placeholder:"Chọn trạng thái",children:[e.jsx(m.Option,{value:"Đang bán",children:"Đang bán"}),e.jsx(m.Option,{value:"Chưa bán",children:"Chưa bán"})]})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"star",label:"Số sao",rules:[{required:!0,message:"Chọn số sao!"}],children:e.jsxs(m,{placeholder:"Chọn trạng thái",children:[e.jsx(m.Option,{value:"3",children:e.jsxs("div",{className:"flex",children:[e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(B,{color:l}),e.jsx(B,{color:l})]})}),e.jsx(m.Option,{value:"4",children:e.jsxs("div",{className:"flex",children:[e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(B,{color:l})]})}),e.jsx(m.Option,{value:"4.5",children:e.jsxs("div",{className:"flex",children:[e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(He,{color:l})]})}),e.jsx(m.Option,{value:"5",children:e.jsxs("div",{className:"flex",children:[e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l}),e.jsx(c,{color:l})]})})]})})})]}),e.jsxs(ee,{gutter:[14,14],children:[e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"price",label:"Giá tiền VN",rules:[{required:!0,message:"Nhập giá tiền!"}],children:e.jsx(E,{className:"w-full mb-2",placeholder:"Nhập giá tiền",min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"sale",label:"Giảm giá %",rules:[{required:!0,message:"Nhập %!"}],children:e.jsx(E,{className:"w-full mb-2",placeholder:"Nhập %",min:0,max:100,step:5})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",label:"Giá sau khi giảm",name:"priceSale",children:e.jsx(E,{className:"w-full mb-2",placeholder:"Giá sau khi giảm",readOnly:!0,min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})})]})]})}),e.jsx(H,{centered:!0,open:P,onCancel:()=>q(!1),footer:null,width:600,children:e.jsx(_e,{centered:!0,items:[{label:"Thêm danh mục",key:"1",children:e.jsx(e.Fragment,{children:e.jsxs(s,{form:h,name:"customForm",layout:"vertical",onFinish:ue,children:[e.jsx(s.Item,{className:"mb-3",name:"category",label:"Tên danh mục",rules:[{required:!0,message:"Nhập tên danh mục!"}],children:e.jsx(x,{placeholder:"Nhập tên danh mục"})}),e.jsx(g,{type:"primary",loading:z,onClick:()=>h.submit(),className:"flex float-end",children:"Thêm danh mục"})]})})},{label:"Chỉnh sửa danh mục",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(Q,{loading:z,data:re,columns:oe,onSave:pe,onDelete:ge,width:"20%",scroll:{x:500,y:350}})})}]})})]})};export{Da as default};

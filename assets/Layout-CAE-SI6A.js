import{r as s,d as m,f as H,c as w,aw as k,ax as R,ay as q,j as u,W as d,a1 as I,az as W,e as O}from"./index-Vh6CaCBN.js";import{b7 as z}from"./Layout-jN7qPcNq.js";import{P as G,p as J,b as N,a as U,c as _,d as K,B as o}from"./index-BMbO9tpa.js";import{S as B}from"./index-BcZ8U7N5.js";import"./index-C3Ojar74.js";import"./context-DmvJlOEW.js";import"./EllipsisOutlined-BN5h1C5H.js";import"./Overflow-Nzkb4Z8L.js";import"./CheckOutlined-r7Yp9YwM.js";import"./TextArea-BYLBHmx3.js";import"./index-DO3-EIkb.js";import"./index-COWI_zw8.js";import"./index-A4s6Kzr0.js";import"./index-BTDpC-Sw.js";import"./SearchOutlined-5O5MTolL.js";import"./GrapeJs-3BCSRXE2.js";import"./fileApi-BUpJpZG8.js";import"./row-BIs4APoP.js";const dt=()=>{var b,x;const[C,j]=s.useState(""),[g,T]=s.useState(!1),f=m(t=>t.pluginsScript.pluginsScript),M=m(t=>t.pluginsScript.loading),{plugins:h,loading:S}=m(t=>t.plugins),$=s.useMemo(()=>h.map(t=>({id:t.id,src:`${H}/uploads/${t.src}`})),[h]),E=w(),A=(t,n)=>{const a=new Date,{html:i,css:c,js:e}=n,y=new DOMParser().parseFromString(i,"text/html"),r=y.querySelector("#Header"),l=y.querySelector("#Footer");let v="",L="";const P=i.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(P&&P[1].trim()===""&&console.log("không có dữ liệu"),!r){d("Chưa có Header!");return}if(!l){d("Chưa có Footer!");return}r&&(v=`<div class="${r.className}">${r.innerHTML}</div>`),l&&(L=`<div id="Footer">${l.innerHTML}</div>`),I(a,"Đang cập nhật..."),k.putLayout(W,{header:v,footer:L,css:c,js:e,edit:t}).then(()=>{O(a,"Cập nhật thành công")}).catch(F=>{d(F.response.data.message)})},D=t=>{t.loadProjectData(C.edit);const n=["video","map","video","bootstrapIcon","map","model-3D","Masonry","quote","link-block","text-basic","text-section","column1","column2","column3","column3-7"],a=["gjs-open-import-webpage","open-templates","link-page","export-template"],i=["Extra","Blog","Layout","Short Codes"],{models:c}=t.BlockManager.getCategories();n.forEach(e=>t.BlockManager.remove(e)),a.forEach(e=>{t.Panels.removeButton("options",e)}),c.forEach(e=>{var p;return i.includes((p=e.get)==null?void 0:p.call(e,"id"))&&e.set("open",!1)})};return s.useEffect(()=>{k.getLayoutEdit().then(t=>{j(t[0]),T(!0)})},[]),s.useEffect(()=>{M===!0&&E(R())},[]),s.useEffect(()=>{S===!0&&E(q())},[]),u.jsxs(z,{margin:0,header:"BỐ CỤC WEBSITE",children:[!g&&u.jsx("div",{children:"LOAdding"}),g&&!S&&u.jsx(G,{height:"calc(100vh - 56px)",configGrapeJs:D,scripts:(b=f[0])==null?void 0:b.scripts,styles:(x=f[0])==null?void 0:x.styles,pluginss:$,plugins:[J,N,U,_,K,o.imageLink,o.header,o.footer,o.container,o.user,B.customType,B.customTypeSelect],savePage:A})]})};export{dt as default};

import{q as V,s as h,r,j as a,T as G,am as S,an as Q,ao as z,aj as o,ap as X,aq as F,ar as J,as as Y,at as Z}from"./index-DjzyvRwx.js";import{b7 as $}from"./Layout-EFL-S3Sh.js";import{E as w}from"./Table-D_68jrlb.js";import{F as u,a as g,b as ee}from"./Filter-csnEzKZl.js";import{d as ae,e as te}from"./Format-BOJtO_o8.js";import{e as le}from"./export-DvvbGYf7.js";import{F as i}from"./index-D35ck0v8.js";import{B as d}from"./button-CmKcfFMN.js";import{T as b}from"./index-CLG6kvxt.js";import{M as D}from"./index-Bj_Q29fP.js";import{T as se}from"./index-4lK1Vipk.js";import{I as A}from"./index-wRejgO5X.js";import{T as N}from"./index-D0mEuH9N.js";import{S as re}from"./index-BHwQyUhE.js";import"./index-DDZmTsZa.js";import"./EllipsisOutlined-DRkMZQPY.js";import"./Overflow-G4f62dog.js";import"./context-BOuCYIwU.js";import"./index-TSiB0zHv.js";import"./index-Du6iFTLT.js";import"./index-KQsL574t.js";import"./row-CZ3IofDq.js";import"./useLocale-8Aa_UwcM.js";import"./PurePanel-BF3wwxBY.js";import"./Dropdown--Jrj-izI.js";import"./index-Bi_65dOL.js";import"./iconUtil-C537UKGV.js";import"./compact-item-wwFPHTMv.js";import"./index-M8qm6Ulq.js";import"./TextArea-2wz-QBZX.js";import"./useVariants-BufFGytT.js";import"./index-DxZruAsQ.js";import"./index-BklRbNQs.js";import"./SearchOutlined-C8-y0AAQ.js";import"./index-uDn68GWU.js";import"./index-BzA_W-VE.js";import"./html2canvas.esm-CBrSDip1.js";import"./jspdf.es.min-DkjKI9ds.js";import"./CheckOutlined-gH9T7rVO.js";const Ve=()=>{const t=V(),f=h(e=>{var s,I;return(I=(s=e.auth)==null?void 0:s.user)==null?void 0:I.userType}),{users:l,loading:p}=h(e=>e.users),{roles:n,loading:v}=h(e=>e.roles),{courses:c,loading:R}=h(e=>e.courses),[x]=i.useForm(),[m]=i.useForm(),[q,y]=r.useState(!1),[E,C]=r.useState(!1),k=r.useMemo(()=>Array.isArray(l==null?void 0:l.newData)?l.newData.map(e=>({...e,key:e==null?void 0:e._id,activeStatus:e!=null&&e.activeStatus?"Cho phép":"Chặn"})):[],[l]),P=r.useMemo(()=>n.map(e=>({...e,key:e._id})),[n]),U=r.useMemo(()=>{var e;return(e=c==null?void 0:c.newData)==null?void 0:e.map(s=>({key:s._id,label:s.name,value:s._id}))},[c]),K=[{title:"Tên người dùng",dataIndex:"name",width:"10%",editable:!1,ellipsis:{showTitle:!0},...u({dataIndex:"name"}),render:e=>a.jsx(G,{placement:"topLeft",title:e,children:e})},{title:"Email",dataIndex:"email",width:"10%",editable:!1,ellipsis:{showTitle:!0},...u({dataIndex:"email"})},{title:"Điện Thoại",dataIndex:"phone",width:"7%",editable:!1,...u({dataIndex:"phone"})},{title:"Giới tính",dataIndex:"gender",width:"7%",type:"select",optionSelect:[{value:"Nam",label:"Nam"},{value:"Nữ",label:"Nữ"}],editable:!0,...g("gender",[{value:"Nam",text:"Nam"},{value:"Nữ",text:"Nữ"}])},{title:"Trạng Thái",dataIndex:"activeStatus",width:"7%",editable:!0,type:"select",optionSelect:[{value:!0,label:"Cho phép"},{value:!1,label:"Chặn"}],...g("activeStatus",[{value:"Cho phép",text:"Cho phép"},{value:"Chặn",text:"Chặn"}])},...f==="admin"?[{title:"Quyền",dataIndex:"userType",width:"7%",editable:!0,type:"select",optionSelect:Array.isArray(n)?n.map(e=>({value:e._id,label:e.nameRole})):[],...Array.isArray(n)&&n.length>0?g("userType",n.map(e=>({text:e.nameRole,value:e._id}))):{}}]:[],{title:"Ngày Tạo",dataIndex:"createdAt",width:"7%",...ee({dataIndex:"createdAt"}),render:e=>ae(e)},...f==="admin"?[{title:"Khóa học",dataIndex:"courseBuy",width:"6%",render:(e,s)=>a.jsx("div",{className:"flex justify-center",children:a.jsx(d,{type:"primary",ghost:!0,onClick:()=>{m.setFieldsValue(s),C(!0)},children:"Khóa học"})})}]:[]],M=[{title:"Tên quyền",dataIndex:"nameRole",width:"20%",editable:!0,...u({dataIndex:"nameRole"}),render:e=>a.jsx(b.Text,{ellipsis:{suffix:""},children:e})},{title:"Quản lý",dataIndex:"role",width:"40%",type:"select-multi",optionSelect:[{value:"adminWebsite",label:"Bài Viết"},{value:"adminCourses",label:"Khóa Học"},{value:"adminOrders",label:"Đơn Hàng"},{value:"adminFileManager",label:"File"}],editable:!0,...u({dataIndex:"name123"}),render:e=>a.jsx(a.Fragment,{children:a.jsx(te,{keywords:e})})}],[j,T]=r.useState(localStorage.getItem("drag")==="true"),O=e=>{o(t,X(e))},_=e=>{e.activeStatus=e.activeStatus==="Chặn"?!1:e.activeStatus==="Cho phép"?!0:e.activeStatus,o(t,F(e))},B=e=>{o(t,J(e),()=>{y(!1),x.resetFields()})},W=e=>{o(t,Y(e))},H=e=>{o(t,Z(e))},L=e=>{e.id=e.key,o(t,F(e))};return r.useEffect(()=>{p&&(t(S({page:1,limit:localStorage.getItem("pageSize")||10})),t(Q()))},[]),r.useEffect(()=>{R===!0&&t(z())},[]),a.jsxs($,{header:"NGƯỜI DÙNG",button:a.jsxs(a.Fragment,{children:[j?a.jsx(d,{onClick:()=>{T(!1),localStorage.setItem("drag","false")},children:a.jsx(b,{children:"Tắt sắp xếp"})}):a.jsx(d,{type:"primary",onClick:()=>{T(!0),localStorage.setItem("drag","true")},children:"Bật sắp xếp"}),a.jsx(d,{onClick:()=>y(!0),type:"primary",children:"Phân quyền"}),a.jsx(d,{onClick:()=>le(k,"Users.xlsx"),type:"primary",children:"Xuất file Excel"})]}),children:[a.jsx(w,{Api:S,total:l==null?void 0:l.totalItems,dragMode:j,loading:p,data:k,columns:K,onSave:_,onDelete:O}),a.jsx(D,{centered:!0,open:q,onCancel:()=>y(!1),footer:null,width:750,children:a.jsx(se,{centered:!0,items:[{label:"Thêm quyền quản trị",key:"1",children:a.jsx(a.Fragment,{children:a.jsxs(i,{form:x,name:"customForm",layout:"vertical",onFinish:B,children:[a.jsx(i.Item,{className:"mb-3",name:"nameRole",label:"Tên quyền",rules:[{required:!0,message:"Nhập tên quyền!"}],children:a.jsx(A,{placeholder:"Nhập tên quyền"})}),a.jsx(i.Item,{className:"mb-3",name:"role",label:"Chức năng quản lý",rules:[{required:!0,message:"Chọn các quyền!"}],children:a.jsx(N,{treeDefaultExpandAll:!0,showSearch:!1,showCheckedStrategy:N.SHOW_PARENT,treeCheckable:!0,treeData:[{title:"Admin",children:[{key:"adminDashboard",value:"adminDashboard",label:"Trang chủ"},{key:"adminWebsite",value:"adminWebsite",label:"Bài Viết"},{key:"adminPlugins",value:"adminPlugins",label:"Plugins"},{key:"adminUsers",value:"adminUsers",label:"Người dùng"},{key:"adminWebsite",value:"adminCourses",label:"Khóa Học"},{key:"adminOrders",value:"adminOrders",label:"Đơn Hàng"},{key:"adminWebsite",value:"adminEmail",label:"Email"},{key:"adminFileManager",value:"adminFileManager",label:"File"},{key:"adminData",value:"adminData",label:"Dữ Liệu"},{key:"adminPayment",value:"adminPayment",label:"Key Thanh Toán"}]},{title:"User",value:"0-1",key:"0-1",children:[{title:"Trang chủ",value:"userDashboard",key:"userDashboard"},{title:"Thông tin",value:"userInfo",key:"userInfo"},{title:"Khóa học",value:"userCourses",key:"userCourses"},{title:"Lịch sử mua hàng",value:"userOrders",key:"userOrders"},{title:"Đổi mật khẩu",value:"userChangePassword",key:"userChangePassword"}]}],placeholder:"Chọn các quyền"})}),a.jsx(d,{type:"primary",loading:v,onClick:()=>x.submit(),className:"flex float-end",children:"Thêm quyền"})]})})},{label:"Chỉnh sửa quyền quản trị",key:"2",children:a.jsx(a.Fragment,{children:a.jsx(w,{loading:v,data:P,columns:M,scroll:{x:500,y:350},width:"10%",onSave:W,onDelete:H})})}]})}),a.jsx(D,{title:a.jsxs(a.Fragment,{children:["Khóa học của học viên: ",a.jsx(b.Text,{type:"danger",children:m.getFieldValue("name")})]}),centered:!0,open:E,onOk:()=>{m.submit()},onCancel:()=>{C(!1),m.resetFields()},confirmLoading:p,width:600,children:a.jsxs(i,{form:m,name:"customFormCourses",layout:"vertical",onFinish:L,children:[a.jsx(i.Item,{className:"mb-4 hidden",name:"key",label:"Khóa học",rules:[{required:!0,message:"Chọn khóa học cần kích hoạt!"}],children:a.jsx(A,{})}),a.jsx(i.Item,{className:"mb-4",name:"courses",label:"Kích hoạt khóa học",children:a.jsx(re,{mode:"multiple",options:U,placeholder:"Chọn khóa học cần kích hoạt"})})]})})]})};export{Ve as default};

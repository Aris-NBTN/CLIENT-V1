import{r as h,j as e,f as P,U as ae,a as se,c as te,t as re,d as $,T as le,ab as ne,Q as ie,ac as p,ai as oe,aj as q,ak as ce,al as de,am as me,an as he}from"./index-DQygNEjr.js";import{b7 as pe}from"./Layout-R2NemduQ.js";import{E as L,T as S}from"./Table-CwlcWHW7.js";import{F as A,a as R,c as z,b as ue}from"./jspdf.es.min-B333PXEZ.js";import{f as xe,F as ge,g as je,d as be,h as ye}from"./Format-Barev0Vi.js";import"./html2canvas.esm-CBrSDip1.js";import{M as fe}from"./index-DoA1f7fE.js";import{U as Ce}from"./index-BQBF0A9Y.js";import{I as Ne}from"./index-Cd90ygYO.js";import{R as Fe,T as we}from"./index-D25t8zFF.js";import{T as E,a as i,b as O,k as Ie}from"./index-Ct1Ahm0O.js";import{F as s}from"./index-4jBdMA-f.js";import{B as v}from"./TextArea-BbSLs1UF.js";import{M as D}from"./index-BNDqDOfz.js";import{I as y}from"./index-D4O7VO_7.js";import{S as d}from"./index-Dejt8Dfe.js";import{R as M,C as g}from"./row-Cmag6w4r.js";import"./index-CdDkQJTk.js";import"./CheckOutlined-6gZ4COK5.js";import"./addEventListener-CYAVvn6X.js";import"./iconUtil-Dsvkvk0T.js";import"./EllipsisOutlined-Dn3jouZ6.js";import"./Overflow-D6XbptX9.js";import"./index-BwCRy9NW.js";import"./index-DyeyqOQ_.js";import"./index-BC-GmJeV.js";import"./SearchOutlined-DkP48hpm.js";import"./index-CSdVbNS1.js";import"./ActionButton-DSgG0UfW.js";import"./index-CZJgFvXt.js";import"./progress-BYV8nrDO.js";import"./index-DjO2sIPK.js";const ve=j=>new Promise((c,m)=>{const o=new FileReader;o.readAsDataURL(j),o.onload=()=>c(o.result),o.onerror=r=>m(r)}),B=({limit:j,apiUpload:c,body:m,fileLists:o,name:r})=>{const[t,f]=h.useState(!1),[C,N]=h.useState(""),u=o==="undefined"?[]:[{uid:o,name:o,status:"done",url:`${P}/uploads/${o}`}],[F,x]=h.useState(u);h.useEffect(()=>{x(u)},[o]);const k=async n=>{!n.url&&!n.preview&&(n.preview=await ve(n.originFileObj)),N(n.url||n.preview),f(!0)},b=({fileList:n,file:l})=>{x(n),l.status==="done"&&ae.put({id:m,[r]:l.response})},w=e.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[e.jsx(Fe,{}),e.jsx("div",{style:{marginTop:8},children:"Tải ảnh lên"})]});return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{data:{folder:"123"},action:c,listType:"picture-card",fileList:F,onPreview:k,onChange:b,children:F.length>=j?null:w}),C&&e.jsx(Ne,{wrapperStyle:{display:"none"},preview:{visible:t,onVisibleChange:n=>f(n),afterOpenChange:n=>!n&&N("")},src:C})]})},la=()=>{const j=se(),c=te(),[m]=s.useForm(),[o]=s.useForm(),[r]=s.useForm(),{token:{colorPrimary:t}}=re.useToken(),f=s.useWatch("price",m),C=s.useWatch("sale",m),[N,u]=h.useState(!1),[F,x]=h.useState(!1),[k,b]=h.useState(!1),{courses:w,loading:n}=$(a=>a.courses),{categoryCourses:l,loading:T}=$(a=>a.categoryCourses),U=h.useMemo(()=>w.map(a=>({...a,key:a._id})),[w]),_=h.useMemo(()=>l.map(a=>({...a,key:a._id})),[l]),G=[{title:"Tên khóa học",dataIndex:"name",width:"10%",type:"text",editable:!0,ellipsis:{showTitle:!0},...A({dataIndex:"name"}),render:a=>e.jsx(le,{placement:"top",title:a,children:a})},{title:"Link",dataIndex:"slug",width:"10%",type:"text",editable:!1,ellipsis:{showTitle:!0},...A({dataIndex:"slug"}),render:a=>e.jsx(e.Fragment,{children:e.jsx(E.Paragraph,{className:"!mb-0",ellipsis:{suffix:""},copyable:{text:`/course/${a}`},children:a})})},{title:"Danh mục",dataIndex:"category",width:"10%",type:"select",editable:!0,optionSelect:Array.isArray(l)&&l.length>0?l==null?void 0:l.map(a=>({label:a.category,value:a._id})):[],...Array.isArray(l)&&l.length>0?R("category",l.map(a=>({text:a.category,value:a._id}))):{},render:a=>a&&l&&Array.isArray(l)&&l.length>0?xe(a,l,"category"):null},{title:"Giá",dataIndex:"price",width:"7%",type:"price",editable:!0,...z({dataIndex:"price",type:"number"}),render:a=>ge(a)},{title:"Giảm",dataIndex:"sale",width:"5%",type:"percent",editable:!0,...z({dataIndex:"sale",type:"number"}),render:a=>je(a)},{title:"Trang thái",dataIndex:"status",width:"8%",type:"select",optionSelect:[{label:"Đang bán",value:"Đang bán"},{label:"Chưa bán",value:"Chưa bán"}],editable:!0,...R("status",[{value:"Đang bán",text:"Đang bán"},{value:"Chưa bán",text:"Chưa bán"}])},{title:"Sao",dataIndex:"star",width:"6%",type:"select",optionSelect:[{label:"3",value:"3"},{label:"4",value:"4"},{label:"4.5",value:"4.5"},{label:"5",value:"5"}],editable:!0},{title:"Ngày tạo",dataIndex:"createdAt",width:"8%",...ue({dataIndex:"createdAt"}),render:a=>be(a)},{title:"Cập nhập",dataIndex:"updatedAt",width:"8%",render:a=>ye(a)},{title:"Thông tin",dataIndex:"info",width:"7%",render:(a,I)=>e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{type:"primary",ghost:!0,onClick:()=>{r.setFieldsValue(I),u(!0)},children:"Thông tin"})})}],H=[{title:"Tên danh mục",dataIndex:"category",width:"70%",type:"text",editable:!0,...A({dataIndex:"category"})}],K=a=>{p(c,oe(a),()=>{x(!1),m.resetFields()})},W=a=>{p(c,q(a))},Q=a=>{a.id=a.key,p(c,q(a),()=>{u(!1),r.resetFields()})},J=a=>{p(c,ce(a))},X=a=>{p(c,de(a),()=>{b(!1),o.resetFields()})},Y=a=>{p(c,me(a))},Z=a=>{p(c,he(a))};return h.useEffect(()=>{n===!0&&c(ne())},[]),h.useEffect(()=>{T&&c(ie())},[]),h.useEffect(()=>{(()=>{const I=m.getFieldValue("price")||0,ee=m.getFieldValue("sale")||0,V=I-I*ee/100;m.setFieldsValue({priceSale:V>=0?V:0})})()},[f,C]),e.jsxs(pe,{header:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center",children:e.jsx("h6",{className:"mb-0",children:"KHÓA HỌC"})})}),button:e.jsxs(e.Fragment,{children:[e.jsx(v,{type:"primary",onClick:()=>{b(!0)},children:" Thêm danh mục"}),e.jsx(v,{type:"primary",onClick:()=>x(!0),children:"Thêm khóa học"})]}),children:[e.jsx(L,{loading:n,data:U,columns:G,onSave:W,onDelete:J,button:a=>e.jsx("div",{className:"flex gap-3",children:e.jsx(fe,{onClick:()=>j(`/admin/course/${a.slug}`),size:20,color:"red"})})}),e.jsx(D,{title:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:["Thông tin khóa học: ",e.jsx(E.Text,{type:"danger",children:r.getFieldValue("name")})]})})}),centered:!0,open:N,maskClosable:!1,onOk:()=>r.submit(),onCancel:()=>{u(!1),r.resetFields()},confirmLoading:n,width:800,children:e.jsxs(s,{form:r,name:"customForm",layout:"vertical",onFinish:Q,children:[e.jsx(s.Item,{className:"mb-0 hidden",name:"key",children:e.jsx(y,{className:"mb-2"})}),e.jsx(s.Item,{className:"mb-2",name:"title",label:"Tiêu đề",children:e.jsx(y,{size:"large",className:"mb-2",placeholder:"Nhập tiêu đề"})}),e.jsx(s.Item,{className:"mb-2",name:"prerequisite",label:"Điều kiện tiên quyết",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập điều kiện tiên quyết",mode:"tags",tokenSeparators:[","]})}),e.jsx(s.Item,{className:"mb-2",name:"customer",label:"Đối tượng khách hàng",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập đối tượng khách hàng",mode:"tags",tokenSeparators:[","]})}),e.jsx(s.Item,{className:"mb-2",name:"output",label:"Tiêu chí đầu ra",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập tiêu chí đầu ra",mode:"tags",tokenSeparators:[","]})}),e.jsx(s.Item,{className:"mb-2",name:"benefit",label:"Lợi ích từ khóa học",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập lợi ích",mode:"tags",tokenSeparators:[","]})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap mt-2 gap-2 justify-center",children:[e.jsx(s.Item,{className:"mb-2",label:"Ảnh bìa",children:e.jsx(B,{apiUpload:`${P}/v1/courser/image`,name:"img",body:r==null?void 0:r.getFieldValue("_id"),fileLists:`${r==null?void 0:r.getFieldValue("img")}`,limit:1})}),e.jsx(s.Item,{className:"mb-2",label:"Ảnh chi tiết",children:e.jsx(B,{apiUpload:`${P}/v1/courser/image`,name:"imgDetail",body:r.getFieldValue("_id"),fileLists:`${r.getFieldValue("imgDetail")}`,limit:1})}),e.jsx(s.Item,{className:"w-full mb-2",name:"description",label:" Mô tả",children:e.jsx(y.TextArea,{size:"large",className:"mb-2",placeholder:"Nhập mô tả",style:{height:100,resize:"none"}})})]})]})}),e.jsx(D,{title:"Khóa học",centered:!0,open:F,onOk:()=>m.submit(),onCancel:()=>x(!1),confirmLoading:n,width:600,children:e.jsxs(s,{form:m,name:"customForm",layout:"vertical",onFinish:K,children:[e.jsx(s.Item,{className:"mb-2",name:"name",label:"Tên khóa học",rules:[{required:!0,message:"Nhập tên khóa học!"}],children:e.jsx(y,{placeholder:"Nhập tên khóa học"})}),e.jsxs(M,{gutter:[14,14],children:[e.jsx(g,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"category",label:"Danh mục",rules:[{required:!0,message:"Chọn danh mục!"}],children:e.jsx(d,{options:l.map(a=>({label:a.category,value:a._id})),placeholder:"Chọn danh mục"})})}),e.jsx(g,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"status",label:"Trạng thái",rules:[{required:!0,message:"Chọn trạng thái!"}],children:e.jsxs(d,{placeholder:"Chọn trạng thái",children:[e.jsx(d.Option,{value:"Đang bán",children:"Đang bán"}),e.jsx(d.Option,{value:"Chưa bán",children:"Chưa bán"})]})})}),e.jsx(g,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"star",label:"Số sao",rules:[{required:!0,message:"Chọn số sao!"}],children:e.jsxs(d,{placeholder:"Chọn trạng thái",children:[e.jsx(d.Option,{value:"3",children:e.jsxs("div",{className:"flex",children:[e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(O,{color:t}),e.jsx(O,{color:t})]})}),e.jsx(d.Option,{value:"4",children:e.jsxs("div",{className:"flex",children:[e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(O,{color:t})]})}),e.jsx(d.Option,{value:"4.5",children:e.jsxs("div",{className:"flex",children:[e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(Ie,{color:t})]})}),e.jsx(d.Option,{value:"5",children:e.jsxs("div",{className:"flex",children:[e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t}),e.jsx(i,{color:t})]})})]})})})]}),e.jsxs(M,{gutter:[14,14],children:[e.jsx(g,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"price",label:"Giá tiền VN",rules:[{required:!0,message:"Nhập giá tiền!"}],children:e.jsx(S,{className:"w-full mb-2",placeholder:"Nhập giá tiền",min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})}),e.jsx(g,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"sale",label:"Giảm giá %",rules:[{required:!0,message:"Nhập %!"}],children:e.jsx(S,{className:"w-full mb-2",placeholder:"Nhập %",min:0,max:100,step:5})})}),e.jsx(g,{span:8,children:e.jsx(s.Item,{className:"mb-0",label:"Giá sau khi giảm",name:"priceSale",children:e.jsx(S,{className:"w-full mb-2",placeholder:"Giá sau khi giảm",readOnly:!0,min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})})]})]})}),e.jsx(D,{centered:!0,open:k,onCancel:()=>b(!1),footer:null,width:600,children:e.jsx(we,{centered:!0,items:[{label:"Thêm danh mục",key:"1",children:e.jsx(e.Fragment,{children:e.jsxs(s,{form:o,name:"customForm",layout:"vertical",onFinish:X,children:[e.jsx(s.Item,{className:"mb-3",name:"category",label:"Tên danh mục",rules:[{required:!0,message:"Nhập tên danh mục!"}],children:e.jsx(y,{placeholder:"Nhập tên danh mục"})}),e.jsx(v,{type:"primary",loading:T,onClick:()=>o.submit(),className:"flex float-end",children:"Thêm danh mục"})]})})},{label:"Chỉnh sửa danh mục",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(L,{loading:T,data:_,columns:H,onSave:Y,onDelete:Z,width:"20%",scroll:{x:500,y:350}})})}]})})]})};export{la as default};

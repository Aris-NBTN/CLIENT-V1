import{r as m,j as e,f as $,U as re,a as ne,c as ie,t as oe,d as L,T as ce,ab as de,Q as me,ac as u,ai as he,aj as R,ak as ue,al as pe,am as xe,an as ge}from"./index-DPFfHbTj.js";import{b7 as je}from"./Layout-0wBzRjNQ.js";import{E as M,T as P}from"./Table-DHg7zC88.js";import{F as D,a as B,c as U,b as be}from"./jspdf.es.min-m1ZRPwF6.js";import{f as ye,F as fe,g as Ce,d as Ne,h as Fe}from"./Format-B2TvVunX.js";import"./html2canvas.esm-CBrSDip1.js";import{M as we}from"./index-DGREgyPa.js";import{U as Ie}from"./index-B8_P7xsB.js";import{I as ve}from"./index-CfL6uHJY.js";import{R as ke,T as Se}from"./index-CLM3ZMSm.js";import{T as V,a as r,b as E,k as Te}from"./index-DKm53qoZ.js";import{F as s}from"./index-CCdBnPbb.js";import{B as F}from"./TextArea-DK2ksbkz.js";import{M as T}from"./index-jQmrWvpe.js";import{I as p}from"./index-Cp33NHr3.js";import{S as d}from"./index-Bqu9kkiM.js";import{R as _,C as y}from"./row-ISapOnoo.js";import"./index-BjYwq8Zp.js";import"./CheckOutlined-DhFJi3pa.js";import"./addEventListener-D0KfPrFc.js";import"./iconUtil-DS1-46id.js";import"./EllipsisOutlined-BjgvgZxb.js";import"./Overflow-cSNaCo9e.js";import"./index-CtXw9-8Y.js";import"./index-1e1zc2L1.js";import"./index-CAmte-kW.js";import"./SearchOutlined-Czk-DP3n.js";import"./index-DPntoNuR.js";import"./ActionButton-CM912I9Y.js";import"./index-Dhd2gnq4.js";import"./progress-Bmv_3eBC.js";import"./index-BXY8SPXK.js";const Ae=f=>new Promise((c,h)=>{const i=new FileReader;i.readAsDataURL(f),i.onload=()=>c(i.result),i.onerror=l=>h(l)}),G=({limit:f,apiUpload:c,body:h,fileLists:i,name:l})=>{const[x,t]=m.useState(!1),[w,I]=m.useState(""),v=i==="undefined"?[]:[{uid:i,name:i,status:"done",url:`${$}/uploads/${i}`}],[g,k]=m.useState(v);m.useEffect(()=>{k(v)},[i]);const S=async o=>{!o.url&&!o.preview&&(o.preview=await Ae(o.originFileObj)),I(o.url||o.preview),t(!0)},A=({fileList:o,file:j})=>{k(o),j.status==="done"&&re.put({id:h,[l]:j.response})},C=e.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[e.jsx(ke,{}),e.jsx("div",{style:{marginTop:8},children:"Tải ảnh lên"})]});return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{data:{folder:"123"},action:c,listType:"picture-card",fileList:g,onPreview:S,onChange:A,children:g.length>=f?null:C}),w&&e.jsx(ve,{wrapperStyle:{display:"none"},preview:{visible:x,onVisibleChange:o=>t(o),afterOpenChange:o=>!o&&I("")},src:w})]})},ca=()=>{const f=ne(),c=ie(),[h]=s.useForm(),[i]=s.useForm(),[l]=s.useForm(),[x]=s.useForm(),{token:{colorPrimary:t}}=oe.useToken(),w=s.useWatch("price",h),I=s.useWatch("sale",h),[v,g]=m.useState(!1),[k,S]=m.useState(!1),[A,C]=m.useState(!1),[o,j]=m.useState(!1),{courses:q,loading:N}=L(a=>a.courses),{categoryCourses:n,loading:O}=L(a=>a.categoryCourses),H=m.useMemo(()=>q.map(a=>({...a,key:a._id})),[q]),K=m.useMemo(()=>n.map(a=>({...a,key:a._id})),[n]),W=[{title:"Tên khóa học",dataIndex:"name",width:"10%",type:"text",editable:!0,ellipsis:{showTitle:!0},...D({dataIndex:"name"}),render:a=>e.jsx(ce,{placement:"top",title:a,children:a})},{title:"Link",dataIndex:"slug",width:"10%",type:"text",editable:!1,ellipsis:{showTitle:!0},...D({dataIndex:"slug"}),render:a=>e.jsx(e.Fragment,{children:e.jsx(V.Paragraph,{className:"!mb-0",ellipsis:{suffix:""},copyable:{text:`/course/${a}`},children:a})})},{title:"Danh mục",dataIndex:"category",width:"10%",type:"select",editable:!0,optionSelect:Array.isArray(n)&&n.length>0?n==null?void 0:n.map(a=>({label:a.category,value:a._id})):[],...Array.isArray(n)&&n.length>0?B("category",n.map(a=>({text:a.category,value:a._id}))):{},render:a=>a&&n&&Array.isArray(n)&&n.length>0?ye(a,n,"category"):null},{title:"Giá",dataIndex:"price",width:"7%",type:"price",editable:!0,...U({dataIndex:"price",type:"number"}),render:a=>fe(a)},{title:"Giảm",dataIndex:"sale",width:"5%",type:"percent",editable:!0,...U({dataIndex:"sale",type:"number"}),render:a=>Ce(a)},{title:"Trang thái",dataIndex:"status",width:"8%",type:"select",optionSelect:[{label:"Đang bán",value:"Đang bán"},{label:"Chưa bán",value:"Chưa bán"}],editable:!0,...B("status",[{value:"Đang bán",text:"Đang bán"},{value:"Chưa bán",text:"Chưa bán"}])},{title:"Sao",dataIndex:"star",width:"6%",type:"select",optionSelect:[{label:"3",value:"3"},{label:"4",value:"4"},{label:"4.5",value:"4.5"},{label:"5",value:"5"}],editable:!0},{title:"Ngày tạo",dataIndex:"createdAt",width:"8%",...be({dataIndex:"createdAt"}),render:a=>Ne(a)},{title:"Cập nhập",dataIndex:"updatedAt",width:"8%",render:a=>Fe(a)},{title:"Thông tin",dataIndex:"info",width:"7%",render:(a,b)=>e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{type:"primary",ghost:!0,onClick:()=>{l.setFieldsValue(b),g(!0)},children:"Thông tin"})})},{title:"SEO",dataIndex:"info",width:"5%",render:(a,b)=>e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{type:"primary",ghost:!0,onClick:()=>{x.setFieldsValue(b),S(!0)},children:"SEO"})})}],Q=[{title:"Tên danh mục",dataIndex:"category",width:"70%",type:"text",editable:!0,...D({dataIndex:"category"})}],J=a=>{u(c,he(a),()=>{C(!1),h.resetFields()})},X=a=>{u(c,R(a))},Y=a=>{a.id=a.key,u(c,R(a),()=>{g(!1),l.resetFields()})},Z=a=>{console.log(a)},ee=a=>{u(c,ue(a))},ae=a=>{u(c,pe(a),()=>{j(!1),i.resetFields()})},se=a=>{u(c,xe(a))},te=a=>{u(c,ge(a))};return m.useEffect(()=>{N===!0&&c(de())},[]),m.useEffect(()=>{O&&c(me())},[]),m.useEffect(()=>{(()=>{const b=h.getFieldValue("price")||0,le=h.getFieldValue("sale")||0,z=b-b*le/100;h.setFieldsValue({priceSale:z>=0?z:0})})()},[w,I]),e.jsxs(je,{header:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center",children:e.jsx("h6",{className:"mb-0",children:"KHÓA HỌC"})})}),button:e.jsxs(e.Fragment,{children:[e.jsx(F,{type:"primary",onClick:()=>{j(!0)},children:" Thêm danh mục"}),e.jsx(F,{type:"primary",onClick:()=>C(!0),children:"Thêm khóa học"})]}),children:[e.jsx(M,{loading:N,data:H,columns:W,onSave:X,onDelete:ee,button:a=>e.jsx("div",{className:"flex gap-3",children:e.jsx(we,{onClick:()=>f(`/admin/course/${a.slug}`),size:20,color:"red"})})}),e.jsx(T,{title:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:["Thông tin khóa học: ",e.jsx(V.Text,{type:"danger",children:l.getFieldValue("name")})]})})}),centered:!0,open:v,maskClosable:!1,onOk:()=>l.submit(),onCancel:()=>{g(!1),l.resetFields()},confirmLoading:N,width:800,children:e.jsxs(s,{form:l,name:"customForm",layout:"vertical",onFinish:Y,children:[e.jsx(s.Item,{className:"mb-0 hidden",name:"key",children:e.jsx(p,{className:"mb-2"})}),e.jsx(s.Item,{className:"mb-2",name:"title",label:"Tiêu đề",children:e.jsx(p,{size:"large",className:"mb-2",placeholder:"Nhập tiêu đề"})}),e.jsx(s.Item,{className:"mb-2",name:"prerequisite",label:"Điều kiện tiên quyết",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập điều kiện tiên quyết",mode:"tags",tokenSeparators:[","]})}),e.jsx(s.Item,{className:"mb-2",name:"customer",label:"Đối tượng khách hàng",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập đối tượng khách hàng",mode:"tags",tokenSeparators:[","]})}),e.jsx(s.Item,{className:"mb-2",name:"output",label:"Tiêu chí đầu ra",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập tiêu chí đầu ra",mode:"tags",tokenSeparators:[","]})}),e.jsx(s.Item,{className:"mb-2",name:"benefit",label:"Lợi ích từ khóa học",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập lợi ích",mode:"tags",tokenSeparators:[","]})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap mt-2 gap-2 justify-center",children:[e.jsx(s.Item,{className:"mb-2",label:"Ảnh bìa",children:e.jsx(G,{apiUpload:`${$}/v1/courser/image`,name:"img",body:l==null?void 0:l.getFieldValue("_id"),fileLists:`${l==null?void 0:l.getFieldValue("img")}`,limit:1})}),e.jsx(s.Item,{className:"mb-2",label:"Ảnh chi tiết",children:e.jsx(G,{apiUpload:`${$}/v1/courser/image`,name:"imgDetail",body:l.getFieldValue("_id"),fileLists:`${l.getFieldValue("imgDetail")}`,limit:1})}),e.jsx(s.Item,{className:"w-full mb-2",name:"description",label:" Mô tả",children:e.jsx(p.TextArea,{size:"large",className:"mb-2",placeholder:"Nhập mô tả",style:{height:100,resize:"none"}})})]})]})}),e.jsx(T,{title:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:["Thông tin khóa học: ",e.jsx(V.Text,{type:"danger",children:l.getFieldValue("name")})]})})}),centered:!0,open:k,maskClosable:!1,onOk:()=>x.submit(),onCancel:()=>{S(!1),x.resetFields()},confirmLoading:N,width:800,children:e.jsxs(s,{form:x,name:"customFormSale",layout:"vertical",onFinish:Z,children:[e.jsx(s.Item,{className:"mb-0 hidden",name:"key",children:e.jsx(p,{className:"mb-2"})}),e.jsx(s.Item,{className:"mb-2",name:"seo",label:"Tiêu đề",children:e.jsx(p.TextArea,{size:"large",className:"mb-2",placeholder:"Nhập tiêu đề",style:{height:400,resize:"none"}})})]})}),e.jsx(T,{title:"Khóa học",centered:!0,open:A,onOk:()=>h.submit(),onCancel:()=>C(!1),confirmLoading:N,width:600,children:e.jsxs(s,{form:h,name:"customForm",layout:"vertical",onFinish:J,children:[e.jsx(s.Item,{className:"mb-2",name:"name",label:"Tên khóa học",rules:[{required:!0,message:"Nhập tên khóa học!"}],children:e.jsx(p,{placeholder:"Nhập tên khóa học"})}),e.jsxs(_,{gutter:[14,14],children:[e.jsx(y,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"category",label:"Danh mục",rules:[{required:!0,message:"Chọn danh mục!"}],children:e.jsx(d,{options:n.map(a=>({label:a.category,value:a._id})),placeholder:"Chọn danh mục"})})}),e.jsx(y,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"status",label:"Trạng thái",rules:[{required:!0,message:"Chọn trạng thái!"}],children:e.jsxs(d,{placeholder:"Chọn trạng thái",children:[e.jsx(d.Option,{value:"Đang bán",children:"Đang bán"}),e.jsx(d.Option,{value:"Chưa bán",children:"Chưa bán"})]})})}),e.jsx(y,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"star",label:"Số sao",rules:[{required:!0,message:"Chọn số sao!"}],children:e.jsxs(d,{placeholder:"Chọn trạng thái",children:[e.jsx(d.Option,{value:"3",children:e.jsxs("div",{className:"flex",children:[e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(E,{color:t}),e.jsx(E,{color:t})]})}),e.jsx(d.Option,{value:"4",children:e.jsxs("div",{className:"flex",children:[e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(E,{color:t})]})}),e.jsx(d.Option,{value:"4.5",children:e.jsxs("div",{className:"flex",children:[e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(Te,{color:t})]})}),e.jsx(d.Option,{value:"5",children:e.jsxs("div",{className:"flex",children:[e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t}),e.jsx(r,{color:t})]})})]})})})]}),e.jsxs(_,{gutter:[14,14],children:[e.jsx(y,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"price",label:"Giá tiền VN",rules:[{required:!0,message:"Nhập giá tiền!"}],children:e.jsx(P,{className:"w-full mb-2",placeholder:"Nhập giá tiền",min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})}),e.jsx(y,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"sale",label:"Giảm giá %",rules:[{required:!0,message:"Nhập %!"}],children:e.jsx(P,{className:"w-full mb-2",placeholder:"Nhập %",min:0,max:100,step:5})})}),e.jsx(y,{span:8,children:e.jsx(s.Item,{className:"mb-0",label:"Giá sau khi giảm",name:"priceSale",children:e.jsx(P,{className:"w-full mb-2",placeholder:"Giá sau khi giảm",readOnly:!0,min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})})]})]})}),e.jsx(T,{centered:!0,open:o,onCancel:()=>j(!1),footer:null,width:600,children:e.jsx(Se,{centered:!0,items:[{label:"Thêm danh mục",key:"1",children:e.jsx(e.Fragment,{children:e.jsxs(s,{form:i,name:"customForm",layout:"vertical",onFinish:ae,children:[e.jsx(s.Item,{className:"mb-3",name:"category",label:"Tên danh mục",rules:[{required:!0,message:"Nhập tên danh mục!"}],children:e.jsx(p,{placeholder:"Nhập tên danh mục"})}),e.jsx(F,{type:"primary",loading:O,onClick:()=>i.submit(),className:"flex float-end",children:"Thêm danh mục"})]})})},{label:"Chỉnh sửa danh mục",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(M,{loading:O,data:K,columns:Q,onSave:se,onDelete:te,width:"20%",scroll:{x:500,y:350}})})}]})})]})};export{ca as default};

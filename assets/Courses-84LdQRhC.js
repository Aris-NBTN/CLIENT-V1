import{r as c,j as e,w as B,a4 as pe,a as ue,q as xe,v as ge,s as U,T as je,ao as H,a2 as be,au as ye,aj as b,av as fe,aw as J,ax as Ce,ay as Ne,az as ve,aA as Ie}from"./index-Cc-1vpYl.js";import{b7 as we}from"./Layout-733AEOU8.js";import{E as W,T as z}from"./Table-DyUCFK3O.js";import{F as L,a as X,c as Y,b as Fe}from"./Filter-wdXz1qrg.js";import{f as Se,F as Te,g as ke,d as Ae,h as De,T as Oe}from"./Format-A0n_o5Us.js";import{e as Pe}from"./export-CCErIoX_.js";import{M as Re}from"./index-DUp2AJIR.js";import{U as qe}from"./index-276162mT.js";import{I as Ve}from"./index-Cc6uNn-2.js";import{R as $e,T as ze}from"./index-BM4oy-f0.js";import{a as o,b as _,h as Le}from"./index-CG-qH4GJ.js";import{F as s}from"./index-NGbqFlrI.js";import{T as E}from"./index-D0fWuZLb.js";import{B as u}from"./button-DdLP26k3.js";import{M}from"./index-DPY8sSwT.js";import{I as x}from"./index-BrC3VjxJ.js";import{S as d}from"./index-BdWzYs5L.js";import{D as _e}from"./index-D4sR0SkG.js";import{R as Q,C as f}from"./row-D_YbyT5k.js";import"./index-Cm-otAoX.js";import"./index-BmQX2tAk.js";import"./useLocale-CQArx0VH.js";import"./context-rMj-ykUU.js";import"./PurePanel-78eoImhg.js";import"./Dropdown-BFwukFt_.js";import"./Overflow-DMuMV_Su.js";import"./EllipsisOutlined-D0dVKAMB.js";import"./index-DQ64fGs7.js";import"./addEventListener-I9xQISnI.js";import"./iconUtil-BlF2GiOy.js";import"./compact-item-Cwd_vZD_.js";import"./index-CSPc7-Im.js";import"./TextArea-BA3qAdpn.js";import"./CheckOutlined-BwGAYYAr.js";import"./index-Buo2xWbB.js";import"./index-vP3YjJUD.js";import"./SearchOutlined-B6ysJDXa.js";import"./index-C6x3o1WO.js";import"./index-BdznlMEz.js";import"./html2canvas.esm-CBrSDip1.js";import"./jspdf.es.min-3GNAb-na.js";import"./progress-OTZmfvJL.js";const Ee=C=>new Promise((h,p)=>{const m=new FileReader;m.readAsDataURL(C),m.onload=()=>h(m.result),m.onerror=r=>p(r)}),Z=({limit:C,apiUpload:h,body:p,fileLists:m,name:r})=>{const[S,l]=c.useState(!1),[T,k]=c.useState(""),N=m==="undefined"?[]:[{uid:m,name:m,status:"done",url:`${B}/uploads/${m}`}],[v,I]=c.useState(N);c.useEffect(()=>{I(N)},[m]);const P=async n=>{!n.url&&!n.preview&&(n.preview=await Ee(n.originFileObj)),k(n.url||n.preview),l(!0)},w=({fileList:n,file:A})=>{I(n),A.status==="done"&&pe.put({id:p,[r]:A.response})},R=e.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[e.jsx($e,{}),e.jsx("div",{style:{marginTop:8},children:"Tải ảnh lên"})]});return e.jsxs(e.Fragment,{children:[e.jsx(qe,{data:{folder:"123"},action:h,listType:"picture-card",fileList:v,onPreview:P,onChange:w,children:v.length>=C?null:R}),T&&e.jsx(Ve,{wrapperStyle:{display:"none"},preview:{visible:S,onVisibleChange:n=>l(n),afterOpenChange:n=>!n&&k("")},src:T})]})};let Me=0;const Da=()=>{const C=ue(),h=xe(),[p]=s.useForm(),[m]=s.useForm(),[r]=s.useForm(),[S]=s.useForm(),{token:{colorPrimary:l}}=ge.useToken(),T=s.useWatch("price",p),k=s.useWatch("sale",p),[N,v]=c.useState(localStorage.getItem("drag")==="true"),I=c.useRef(null),[P,w]=c.useState(!1),[R,n]=c.useState(!1),[A,q]=c.useState(!1),[G,ee]=c.useState([]),[D,ae]=c.useState({}),{courses:g,loading:O}=U(a=>a.courses),{categoryCourses:V,loading:$}=U(a=>a.categoryCourses),t=V==null?void 0:V.newData,K=c.useMemo(()=>{var a;return(a=g==null?void 0:g.newData)==null?void 0:a.map(i=>({...i,key:i._id}))},[g]),se=c.useMemo(()=>t==null?void 0:t.map(a=>({...a,key:a._id})),[t]),te=a=>{const{name:i,svgCode:F}=a,j=i||`New item ${Me++}`;ee([...G,j]),ae({...D,[j]:F}),S.resetFields(),setTimeout(()=>{var y;(y=I.current)==null||y.focus()},0)},le=[{title:"Tên khóa học",dataIndex:"name",width:"15%",type:"text",editable:!0,ellipsis:{showTitle:!0},...L({dataIndex:"name"}),render:a=>e.jsx(je,{placement:"top",title:a,children:a})},{title:"Link",dataIndex:"slug",width:"8%",type:"text",editable:!1,ellipsis:{showTitle:!0},...L({dataIndex:"slug"}),render:a=>e.jsx(e.Fragment,{children:e.jsx(E.Paragraph,{className:"!mb-0",ellipsis:{suffix:""},copyable:{text:`/course/${a}`},children:a})})},{title:"Danh mục",dataIndex:"category",width:"10%",type:"select",editable:!0,optionSelect:Array.isArray(t)&&(t==null?void 0:t.length)>0?t==null?void 0:t.map(a=>({label:a.category,value:a._id})):[],...Array.isArray(t)&&(t==null?void 0:t.length)>0?X("category",t==null?void 0:t.map(a=>({text:a.category,value:a._id}))):{},render:a=>a&&t&&Array.isArray(t)&&(t==null?void 0:t.length)>0?Se(a,t,"category"):null},{title:"Giá",dataIndex:"price",width:"8%",type:"price",editable:!0,...Y({dataIndex:"price",type:"number"}),render:a=>Te(a)},{title:"Giảm",dataIndex:"sale",width:"5%",type:"percent",editable:!0,...Y({dataIndex:"sale",type:"number"}),render:a=>ke(a)},{title:"Trang thái",dataIndex:"status",width:"8%",type:"select",optionSelect:[{label:"Đang bán",value:"Đang bán"},{label:"Chưa bán",value:"Chưa bán"}],editable:!0,...X("status",[{value:"Đang bán",text:"Đang bán"},{value:"Chưa bán",text:"Chưa bán"}])},{title:"Sao",dataIndex:"star",width:"6%",type:"select",optionSelect:[{label:"3",value:"3"},{label:"4",value:"4"},{label:"4.5",value:"4.5"},{label:"5",value:"5"}],editable:!0},{title:"Ngày tạo",dataIndex:"createdAt",width:"8%",...Fe({dataIndex:"createdAt"}),render:a=>Ae(a)},{title:"Cập nhập",dataIndex:"updatedAt",width:"8%",render:a=>De(a)},{title:"Thông tin",dataIndex:"info",width:"7%",render:(a,i)=>e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{type:"primary",ghost:!0,onClick:()=>{r.setFieldsValue(i),w(!0)},children:"Thông tin"})})}],re=[{title:"Tên danh mục",dataIndex:"category",width:"70%",type:"text",editable:!0,...L({dataIndex:"category"})}],ne=a=>{b(h,fe(a),()=>{n(!1),p.resetFields()})},ie=a=>{b(h,J(a))},oe=a=>{a.id=a.key,b(h,J(a),()=>{w(!1),r.resetFields()})},ce=a=>{b(h,Ce(a))},de=a=>{b(h,Ne(a),()=>{q(!1),m.resetFields()})},me=a=>{b(h,ve(a))},he=a=>{b(h,Ie(a))};return c.useEffect(()=>{O&&h(H({page:1,limit:localStorage.getItem("pageSize")||10}))},[]),c.useEffect(()=>{$&&h(be())},[]),c.useEffect(()=>{(()=>{const i=p.getFieldValue("price")||0,F=p.getFieldValue("sale")||0,j=i-i*F/100;p.setFieldsValue({priceSale:j>=0?j:0})})()},[T,k]),e.jsxs(we,{title:"Khóa học",header:e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center",children:e.jsx("h6",{className:"mb-0",children:"KHÓA HỌC"})})}),button:e.jsxs(e.Fragment,{children:[N?e.jsx(u,{onClick:()=>{v(!1),localStorage.setItem("drag","false")},children:e.jsx(E,{children:"Tắt sắp xếp"})}):e.jsx(u,{type:"primary",onClick:()=>{v(!0),localStorage.setItem("drag","true")},children:"Bật sắp xếp"}),e.jsx(u,{type:"primary",onClick:()=>{q(!0)},children:" Thêm danh mục"}),e.jsx(u,{type:"primary",onClick:()=>n(!0),children:"Thêm khóa học"}),e.jsx(u,{onClick:()=>Pe(K,"Course.xlsx"),type:"primary",children:"Xuất file Excel"})]}),children:[e.jsx(W,{ApiPut:ye,Api:H,dragMode:N,total:g==null?void 0:g.totalPages,loading:O,data:K,columns:le,onSave:ie,onDelete:ce,button:a=>e.jsx("div",{className:"flex gap-3",children:e.jsx(Re,{onClick:()=>{C(`/admin/course/${a._id}`),localStorage.setItem("name-course",a.name)},size:20,color:"red"})})}),e.jsx(M,{title:e.jsxs(e.Fragment,{children:["  Thông tin khóa học: ",e.jsx(E.Text,{type:"danger",children:r.getFieldValue("name")})," "]}),centered:!0,open:P,maskClosable:!1,onOk:()=>r.submit(),onCancel:()=>{w(!1),r.resetFields()},confirmLoading:O,width:800,children:e.jsxs(s,{form:r,name:"customForm",layout:"vertical",onFinish:oe,children:[e.jsx(s.Item,{className:"mb-0 hidden",name:"key",children:e.jsx(x,{className:"mb-2"})}),e.jsx(s.Item,{className:"mb-2",name:"title",label:"Tiêu đề",children:e.jsx(x,{size:"large",className:"mb-2",placeholder:"Nhập tiêu đề"})}),e.jsx(s.Item,{className:"mb-2",name:"prerequisite",label:"Điều kiện tiên quyết",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập điều kiện tiên quyết",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"customer",label:"Đối tượng khách hàng",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập đối tượng khách hàng",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"output",label:"Tiêu chí đầu ra",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập tiêu chí đầu ra",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"benefit",label:"Lợi ích từ khóa học",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn & nhập lợi ích",mode:"tags"})}),e.jsx(s.Item,{className:"mb-2",name:"includes",label:"Khóa học bao gồm",children:e.jsx(d,{size:"large",mode:"multiple",placeholder:"Chọn & nhập thông tin",tagRender:a=>{const{value:i,closable:F,onClose:j}=a;if(i!==void 0){const y=JSON.parse(i);return e.jsx(Oe,{style:{height:32,marginInlineEnd:4},closable:F,onClose:j,className:"flex items-center",children:e.jsxs("div",{className:"flex",children:[y.svgCode?e.jsx("div",{dangerouslySetInnerHTML:{__html:y.svgCode},style:{width:"20px",marginRight:"8px"}}):null,y.name]})})}},onChange:a=>{console.log(a)},dropdownRender:a=>e.jsxs(e.Fragment,{children:[a,e.jsx(_e,{style:{margin:"8px 0"}}),e.jsx(s,{form:S,onFinish:te,layout:"vertical",children:e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(s.Item,{name:"name",className:"!mb-0",rules:[{required:!0,message:"Nhập thông tin!"}],children:e.jsx(x,{style:{width:200},placeholder:"Nhập thông tin",ref:I,onKeyDown:i=>i.stopPropagation()})}),e.jsx(s.Item,{name:"svgCode",className:"!mb-0",rules:[{required:!0,message:"Nhập SVG icon!"}],children:e.jsx(x,{style:{width:200},placeholder:"Nhập mã SVG icon",onKeyDown:i=>i.stopPropagation()})}),e.jsx(u,{className:"w-full",type:"primary",ghost:!0,htmlType:"submit",children:"Thêm thông tin"})]})})]}),options:G.map(a=>({label:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[D[a]&&e.jsx("div",{dangerouslySetInnerHTML:{__html:D[a]},style:{width:"20px",marginRight:"8px"}}),a]}),value:JSON.stringify({name:a,svgCode:D[a]||""})}))})}),e.jsx(s.Item,{className:"mb-2",name:"hidden",label:"Ẩn thông tin",children:e.jsx(d,{size:"large",className:"w-full mb-2",placeholder:"Chọn thông tin cần ẩn",mode:"multiple",options:[{label:"Lợi ích từ khóa học",value:"benefit"},{label:"Yêu cầu khóa học",value:"prerequisite"},{label:"Đối tượng khách hàng",value:"customer"},{label:"Tiêu chí đầu ra",value:"output"},{label:"Nội dung khóa học",value:"module"},{label:"Đánh giá từ học viên",value:"review"}]})}),e.jsx(s.Item,{className:"mb-0 hidden",name:"seo",children:e.jsx(x,{className:"mb-2"})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap mt-2 gap-2 justify-center",children:[e.jsx(s.Item,{className:"mb-2",label:"Ảnh bìa",children:e.jsx(Z,{apiUpload:`${B}/v1/courser/image`,name:"img",body:r==null?void 0:r.getFieldValue("_id"),fileLists:`${r==null?void 0:r.getFieldValue("img")}`,limit:1})}),e.jsx(s.Item,{className:"mb-2",label:"Ảnh chi tiết",children:e.jsx(Z,{apiUpload:`${B}/v1/courser/image`,name:"imgDetail",body:r.getFieldValue("_id"),fileLists:`${r.getFieldValue("imgDetail")}`,limit:1})}),e.jsx(s.Item,{className:"w-full mb-2",name:"description",label:" Mô tả",children:e.jsx(x.TextArea,{size:"large",className:"mb-2",placeholder:"Nhập mô tả",style:{height:100,resize:"none"}})})]})]})}),e.jsx(M,{title:"Khóa học",centered:!0,open:R,onOk:()=>p.submit(),onCancel:()=>n(!1),confirmLoading:O,width:600,children:e.jsxs(s,{form:p,name:"customForm",layout:"vertical",onFinish:ne,children:[e.jsx(s.Item,{className:"mb-2",name:"name",label:"Tên khóa học",rules:[{required:!0,message:"Nhập tên khóa học!"}],children:e.jsx(x,{placeholder:"Nhập tên khóa học"})}),e.jsxs(Q,{gutter:[14,14],children:[e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"category",label:"Danh mục",rules:[{required:!0,message:"Chọn danh mục!"}],children:e.jsx(d,{options:t==null?void 0:t.map(a=>({label:a.category,value:a._id})),placeholder:"Chọn danh mục"})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"status",label:"Trạng thái",rules:[{required:!0,message:"Chọn trạng thái!"}],children:e.jsxs(d,{placeholder:"Chọn trạng thái",children:[e.jsx(d.Option,{value:"Đang bán",children:"Đang bán"}),e.jsx(d.Option,{value:"Chưa bán",children:"Chưa bán"})]})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-2",name:"star",label:"Số sao",rules:[{required:!0,message:"Chọn số sao!"}],children:e.jsxs(d,{placeholder:"Chọn trạng thái",children:[e.jsx(d.Option,{value:"3",children:e.jsxs("div",{className:"flex",children:[e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(_,{color:l}),e.jsx(_,{color:l})]})}),e.jsx(d.Option,{value:"4",children:e.jsxs("div",{className:"flex",children:[e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(_,{color:l})]})}),e.jsx(d.Option,{value:"4.5",children:e.jsxs("div",{className:"flex",children:[e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(Le,{color:l})]})}),e.jsx(d.Option,{value:"5",children:e.jsxs("div",{className:"flex",children:[e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l}),e.jsx(o,{color:l})]})})]})})})]}),e.jsxs(Q,{gutter:[14,14],children:[e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"price",label:"Giá tiền VN",rules:[{required:!0,message:"Nhập giá tiền!"}],children:e.jsx(z,{className:"w-full mb-2",placeholder:"Nhập giá tiền",min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",name:"sale",label:"Giảm giá %",rules:[{required:!0,message:"Nhập %!"}],children:e.jsx(z,{className:"w-full mb-2",placeholder:"Nhập %",min:0,max:100,step:5})})}),e.jsx(f,{span:8,children:e.jsx(s.Item,{className:"mb-0",label:"Giá sau khi giảm",name:"priceSale",children:e.jsx(z,{className:"w-full mb-2",placeholder:"Giá sau khi giảm",readOnly:!0,min:0,step:1e5,parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})})})]})]})}),e.jsx(M,{centered:!0,open:A,onCancel:()=>q(!1),footer:null,width:600,children:e.jsx(ze,{centered:!0,items:[{label:"Thêm danh mục",key:"1",children:e.jsx(e.Fragment,{children:e.jsxs(s,{form:m,name:"customForm",layout:"vertical",onFinish:de,children:[e.jsx(s.Item,{className:"mb-3",name:"category",label:"Tên danh mục",rules:[{required:!0,message:"Nhập tên danh mục!"}],children:e.jsx(x,{placeholder:"Nhập tên danh mục"})}),e.jsx(u,{type:"primary",loading:$,onClick:()=>m.submit(),className:"flex float-end",children:"Thêm danh mục"})]})})},{label:"Chỉnh sửa danh mục",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(W,{loading:$,data:se,columns:re,onSave:me,onDelete:he,width:"20%",scroll:{x:500,y:350}})})}]})})]})};export{Da as default};

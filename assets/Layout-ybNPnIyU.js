import{r as o,c as F,d as u,f as w,aY as k,aZ as R,aH as q,j as d,W as g,a3 as I,a_ as W,t as O}from"./index-CcDScCIj.js";import{b7 as _}from"./Layout-rT2rL0Mv.js";import{P as G,p as J,a as N,B as a}from"./index-CfocsqHw.js";import{p as U,b as Y,a as Z}from"./index-BaK9lv42.js";import{S as B}from"./index-BcZ8U7N5.js";import"./index-Do_G6Ik8.js";import"./TextArea-DcrxrkUU.js";import"./CheckOutlined-CzI6vixS.js";import"./EllipsisOutlined-DOAbwiOn.js";import"./Overflow-DYxonkPG.js";import"./index-BCiBb8i7.js";import"./index-DzmEW-zz.js";import"./index-GvQfN75r.js";import"./index-6EM9zGX5.js";import"./index-BeJqwAnw.js";import"./SearchOutlined-Cw6RRrfB.js";import"./fileApi-BF5u9JAm.js";import"./indexFile-KYTZc652.js";import"./row-Bv7HvGZ0.js";const gt=()=>{var b,v;const[C,j]=o.useState(""),[f,T]=o.useState(!1),h=F(),S=u(t=>t.pluginsScript.pluginsScript),M=u(t=>t.pluginsScript.loading),{plugins:i,loading:E}=u(t=>t.plugins),D=o.useMemo(()=>{var t;return(t=i==null?void 0:i.newData)==null?void 0:t.map(s=>({id:s.id,src:`${w}/uploads/${s.src}`}))},[i]),H=(t,s)=>{const r=new Date,{html:n,css:p,js:e}=s,x=new DOMParser().parseFromString(n,"text/html"),c=x.querySelector("#Header"),m=x.querySelector("#Footer");let y="",L="";const P=n.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(P&&P[1].trim()===""&&console.log("không có dữ liệu"),!c){g("Chưa có Header!");return}if(!m){g("Chưa có Footer!");return}c&&(y=`<div class="${c.className}">${c.innerHTML}</div>`),m&&(L=`<div id="Footer">${m.innerHTML}</div>`),I(r,"Đang cập nhật..."),k.putLayout(W,{header:y,footer:L,css:p,js:e,edit:t}).then(()=>{O(r,"Cập nhật thành công")}).catch(A=>{g(A.response.data.message)})},$=t=>{t.loadProjectData(C.edit);const s=["video","map","video","bootstrapIcon","map","model-3D","Masonry","quote","link-block","text-basic","text-section","column1","column2","column3","column3-7"],r=["gjs-open-import-webpage","open-templates","link-page","export-template"],n=["Extra","Blog","Layout","Short Codes"],{models:p}=t.BlockManager.getCategories();s.forEach(e=>t.BlockManager.remove(e)),r.forEach(e=>{t.Panels.removeButton("options",e)}),p.forEach(e=>{var l;return n.includes((l=e.get)==null?void 0:l.call(e,"id"))&&e.set("open",!1)})};return o.useEffect(()=>{k.getLayoutEdit().then(t=>{j(t[0]),T(!0)})},[]),o.useEffect(()=>{M===!0&&h(R())},[]),o.useEffect(()=>{E===!0&&h(q())},[]),d.jsxs(_,{margin:0,header:"BỐ CỤC WEBSITE",children:[!f&&d.jsx("div",{children:"LOAdding"}),f&&!E&&d.jsx(G,{height:"calc(100vh - 56px)",configGrapeJs:$,scripts:(b=S[0])==null?void 0:b.scripts,styles:(v=S[0])==null?void 0:v.styles,pluginss:D,plugins:[U,Y,Z,J,N,a.imageLink,a.header,a.footer,a.container,a.user,B.customType,B.customTypeSelect],savePage:H})]})};export{gt as default};

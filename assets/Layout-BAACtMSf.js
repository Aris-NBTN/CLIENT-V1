import{r as s,q as H,s as c,x as q,b2 as j,b3 as w,b4 as I,j as d,G as g,z as R,b5 as G,t as O}from"./index-C2-G6Wry.js";import{b7 as W}from"./Layout-DD5NNNR0.js";import{P as z,p as J,b as N,a as U,B as a}from"./index-CeA4qnlp.js";import{p as _,a as K,S as k}from"./index-BLZGZfSB.js";import"./index-GYUxojEI.js";import"./EllipsisOutlined-CXfOAIN_.js";import"./Overflow-BGhpI4Hj.js";import"./context-wxW2FRQh.js";import"./index-CrnRjpcN.js";import"./index-BDdBz3vX.js";import"./index-C72UP8jl.js";import"./row-Drysuo5r.js";import"./index-DQCGOMvu.js";import"./useLocale-bRjSkgqv.js";import"./TextArea-COScc1w9.js";import"./CheckOutlined-DF8Komkl.js";import"./compact-item-C-0qd4rQ.js";import"./button-WA74xdHL.js";import"./index-BZLMfKYW.js";import"./PurePanel-DaSICzd8.js";import"./index-uMvLK5h8.js";import"./SearchOutlined-C1Qo8NWk.js";import"./Dropdown-nqVSVu1t.js";import"./index-CpCBM72S.js";import"./index-Lgq4QDM0.js";import"./fileApi-B9bsi4rD.js";const vt=()=>{var x,E;const[B,C]=s.useState(""),[h,T]=s.useState(!1),f=H(),S=c(t=>t.pluginsScript.pluginsScript),M=c(t=>t.pluginsScript.loading),{plugins:i,loading:b}=c(t=>t.plugins),{pluginsScript:D}=c(t=>t.pluginsScript);s.useMemo(()=>{var t;return(t=i==null?void 0:i.newData)==null?void 0:t.map(o=>({id:o.id,src:`${q}/uploads/${o.src}`}))},[i]);const $=(t,o)=>{const r=new Date,{html:n,css:l,js:e}=o,v=new DOMParser().parseFromString(n,"text/html"),p=v.querySelector("#Header"),u=v.querySelector("#Footer");let y="",L="";const P=n.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(P&&P[1].trim()===""&&console.log("không có dữ liệu"),!p){g("Chưa có Header!");return}if(!u){g("Chưa có Footer!");return}p&&(y=`<div class="${p.className}">${p.innerHTML}</div>`),u&&(L=`<div id="Footer">${u.innerHTML}</div>`),R(r,"Đang cập nhật..."),j.putLayout(G,{header:y,footer:L,css:l,js:e,edit:t}).then(()=>{O(r,"Cập nhật thành công")}).catch(F=>{g(F.response.data.message)})},A=t=>{t.loadProjectData(B.edit);const o=["video","map","video","bootstrapIcon","map","model-3D","Masonry","quote","link-block","text-basic","text-section","column1","column2","column3","column3-7"],r=["gjs-open-import-webpage","open-templates","link-page","export-template"],n=["Extra","Blog","Layout","Short Codes"],{models:l}=t.BlockManager.getCategories();o.forEach(e=>t.BlockManager.remove(e)),r.forEach(e=>{t.Panels.removeButton("options",e)}),l.forEach(e=>{var m;return n.includes((m=e.get)==null?void 0:m.call(e,"id"))&&e.set("open",!1)})};return s.useEffect(()=>{j.getLayoutEdit().then(t=>{C(t[0]),T(!0)})},[]),s.useEffect(()=>{M===!0&&f(w())},[]),s.useEffect(()=>{b===!0&&f(I())},[]),d.jsxs(W,{margin:0,header:"BỐ CỤC WEBSITE",children:[!h&&d.jsx("div",{children:"LOAdding"}),h&&!b&&d.jsx(z,{height:"calc(100vh - 56px)",configGrapeJs:A,scripts:(x=S[0])==null?void 0:x.scripts,styles:(E=S[0])==null?void 0:E.styles,pluginss:[{id:"grapesjs-component-icon",src:"http://localhost:8082/plugins/icon/IndexLayout.js"}],plugins:[J,N,U,_,K,a.imageLink,a.header,a.footer,a.container,a.user,k.customType,k.customTypeSelect],canvas:D[0],savePage:$})]})};export{vt as default};
